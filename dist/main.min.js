const openItem = item =>{
const container = item.closest('.team__item')
const contentBlock = container.find('.team__about')
const textBlock = contentBlock.find('.team__about-block')
const reqHeight = textBlock.height()
const descPolygon = container.find('.team__desc')
container.addClass('active')
contentBlock.height(reqHeight)
descPolygon.css('transform','rotate(60deg)')


}
const closeEveryItem = container =>{
  const items = container.find('.team__about')
  const itemContainer = container.find('.team__item')
  const descPolygon = container.find('.team__desc')
  descPolygon.css('transform','rotate(0deg)')
  itemContainer.removeClass('active')
  items.height(0)
}
$('.team__name').on('click',e=>{
  $this = $(e.currentTarget)
  // $('.team__name').css({'color':'#fff934'})
  const container = $this.closest('.team')
  const elemContainer = $this.closest('.team__item')
  if (elemContainer.hasClass('active')){
    closeEveryItem(container)
  }else{
    closeEveryItem(container)
    openItem($this)
  
  }


});let hamburgerMenu = document.querySelector("#burgerMenu");
let hamburgerButton = document.querySelector("#burger");
hamburgerButton.addEventListener("click", function (e) {
  e.preventDefault();
  hamburgerButton.classList.toggle("burger--active");
  hamburgerMenu.classList.toggle("menu--active");
  document.body.classList.toggle("fancybox-active");
  document.body.classList.toggle("compensate-for-scrollbar");
});

let prevButton = document.querySelector(".boards__nav--prev");
let nextButton = document.querySelector(".boards__nav--next");
let slide = document.querySelector(".boards");
// nextButton.addEventListener('click', function(e){
//   e.preventDefault()
//   slide.classList.toggle('.boards_container--active')
// }

// )
// console.log(prevButton);

//   if (
//     hamburgerButton.classList.contains("burger--active") == true &&
//     hamburgerMenu.classList.contains("burger--active") == true
//   ) {
//     hamburgerButton.classList. ove == "burger--active";
//     hamburgerMenu.classList. ove == "menu--active";
//   } else if (
//     hamburgerButton.classList.contains("burger--active") != true &&
//     hamburgerMenu.classList.contains("burger--active") != true
//   ) {
//       hamburgerButton.classList.add("burger--active");
//       hamburgerMenu.classList.add("menu--active");
//   }
// });

// let form = document.querySelector(".form");
// let formElements = form.elements;
// let button = formElements[11];

// button.addEventListener("click", function (e) {
//   e.preventDefault();
//   let userName = formElements[0].value;
//   let phone = formElements[1].value;
//   let adress =
//     "ул. " +
//     formElements[2].value +
//     " " +
//     "дом. " +
//     formElements[3].value +
//     " " +
//     "корп." +
//     formElements[4].value +
//     " " +
//     "кв. " +
//     formElements[5].value +
//     " " +
//     "эт. " +
//     formElements[6].value;
//   let comment = formElements[7].value;
//   if (formElements[8].checked == true) {
//     paymant = "Оплата наличными";
//   } else {
//     paymant = "Оплата картой";
//   }
//   alert(userName + phone + " " + adress + " " + paymant + " " + comment);
//   console.log(formElements);
//   console.log(userName, phone, adress, paymant, comment);
// });
// $(document).ready(() => {
//   $(".form__btn").on("click", (e) => {
//     e.preventDefault();
//     let formTitle = $(".form__title");
//     let formInput = $(".form__input");
//     // $.each(formTitle),(ndx, item ) =>{
//     //   let formTitleElements= $(item)[ndx].innerText
//     //   console.log(formTitleElements)
//     // }
//     for (let i = 0; i < formTitle.length; i++) {
//       let formTitleElements = formTitle[i].innerText;
//       let formInputValues = $(formInput[i + 1]).val();
//       let result = formTitleElements + ": " + formInputValues;
//       console.log(result);
//     }
//   });
// });
;let myMap;

const init = () => {
  myMap = new ymaps.Map("map", {
    center: [59.935274, 30.312388],
    zoom: 11,
  });
  const coords = [
    [59.94554327989287, 30.38935262114668],
    [59.91142323563909, 30.50024587065841],
    [59.88693161784606, 30.319658102103713],
    [59.97033574821672, 30.315194906302924],
  ];
  const myCollection = new ymaps.GeoObjectCollection(
    {},
    {
      draggable: false,
      iconLayout: "default#image",
      iconImageHref: "./img/marker.svg",
      iconImageSize: [46, 57],
      iconImageOffset: [-35, -52],
    }
  );
  coords.forEach((coord) => {
    myCollection.add(new ymaps.Placemark(coord));
  });

  myMap.geoObjects.add(myCollection);
  myMap.behaviors.disable("scrollZoom");
};

ymaps.ready(init);
;const validateFields = (form, fieldsArray) => {
  fieldsArray.forEach((field) => {
    field.removeClass("input-error");
    if (field.val().trim() === "") {
      field.addClass("input-error");
    }
  });
  const errorFields = form.find(".input-error");
  return errorFields.length === 0;
};

$(".form__btn").on('click',(e) => {
  e.preventDefault();

  const form = $(".form");
  const name = form.find("[name = 'name']");
  const phone = form.find("[name = 'phone']");
  const comment = form.find(".form__input--textarea");
  const to = form.find("[name = 'to']");
  const content = $(".modal__content");
  isValid = validateFields(form, [name, phone, comment, to]);

  if (isValid) {
    const request = $.ajax({
      url: "https://webdev-api.loftschool.com/sendmail",
      method: "post",
      data: {
        name: name.val(),
        phone: phone.val(),
        comment: comment.val(),
        to: to.val(),
      },
    });
    request.done((data) => {
      content.removeClass("error-text");
      content.text(data.message);
    });
    request.fail((data) => {
      let message;
      if(data?.responseJSON?.message){
        message = responseJSON.message
      }else{
        message = 'Произошла ошибка,попробуйте позже'
      }
      content.text(message);
      content.addClass("error-text");
    });
    request.always(() => {
     $.fancybox.open({
      src:'#form-modal',
      type:'inline',
     })
    });
  }
});

$(".btn--close").on('click',(e) => {
  e.preventDefault();
  $.fancybox.close()
  // $(".form-modal").css({ height: "0%", width: "0%" });
});
;
//methods
// $.fn.fullpage.setAllowScrolling(false);

let doFullpage = document.documentElement.clientWidth;
$(document).ready(function () {
  //что бы не работал на мобилках
  // if (doFullpage > 768) {
    $("#fullpage").fullpage({
      //options here
      scrollOverflow: false,
      autoScrolling: true,
      scrollHorizontally: true,
      verticalCentered: false,
      fitToSection: false,
      navigation: true,
      // anchors:['#why', '#boards', '#reviews'],
      scrollOverflow: false,

      // fixedElements:('.header')
    });

  }
);
$("[data-scroll-to]").on('click',(e) => {
  e.preventDefault();
  const $this = $(e.currentTarget);
  const target = $this.attr("data-scroll-to");
  const reqSection = $(`[data-section-id = ${target}]`);

  performTransition(reqSection.index());
});

//----------------------------------------------------------------------------------------------------------//

const sections = $("section");
const display = $(".maincontent");
let inScroll = false;
sections.first().addClass("active");

const performTransition = (sectionEq) => {
  if (inScroll === false) {
    inScroll = true;
    const position = sectionEq * -100;
    display.css({
      transform: `translateY(${position}%)`,
    });
    sections.eq(sectionEq).addClass("active").siblings().removeClass("active");
    setTimeout(() => {
      inScroll = false;
    }, 800);
  }
};
// const viewportScroller = () => {
//   const activeSection = sections.filter(".active");
//   const nextSection = activeSection.next();
//   const prevSection = activeSection.prev();
//   return {
//     next() {
//       if (nextSection.length) {
//         performTransition(nextSection.index());
//       }
//     },
//     prev() {
//       if (prevSection.length) {
//         performTransition(prevSection.index());
//       }
//     },
//   };
// };
// $(window).on("wheel", (e) => {
//   const deltaY = e.originalEvent.deltaY;
//   const scroller = viewportScroller();
//   // let map = $('.map')
//   // console.log(map)
//   if (deltaY > 0) {
//     //&& e.target != map
//     //next
//     scroller.next();
//   }
//   if (deltaY < 0) {
//     //prev
//     scroller.prev();
//   }
// });
// $(window).on("keydown", (e) => {
//   const tagName = e.target.tagName.toLowerCase();
//   const scroller = viewportScroller();
//   if (tagName != "textarea" && tagName != "input") {
//     switch (e.key) {
//       case 38:
//         scroller.prev();
//         break;
//       case 40:
//         scroller.next();
//         break;
//     }
//   }
// });

// $("[data-scroll-to]").on('click',(e) => {
//   e.preventDefault();
//   const $this = $(e.currentTarget);
//   const target = $this.attr("data-scroll-to");
//   const reqSection = $(`[data-section-id = ${target}]`);

//   performTransition(reqSection.index());
// });

// //https://github.com/mattbryson/TouchSwipe-Jquery-Plugin
// $(function () {
//   $("body").swipe({

//     //Generic swipe handler for all directions
//     swipe: function (event, direction) {
//       const scroller = viewportScroller();
//       let scrollDirection = "";
//       if (direction === "up") {
//         scrollDirection = "next";
//       }
//       if (direction === "down") {
//         scrollDirection = "prev";
//       }
//       scroller[scrollDirection]();
//     },
//   });
// });
;// let player;
// const playerContainer = $(".player");
// const playerStart = $(".player__start");
// const playerSplash = $(".player__splash");
// ////play/pause////

// ////seconds to seconds:minutes////
// const formatTime = (timeSec) => {
//   const roundTime = Math.round(timeSec);

//   const minutes = addZero(Math.floor(roundTime / 60));
//   const seconds = addZero(roundTime - minutes * 60);

//   function addZero(num) {
//     return num < 10 ? `0${num}` : num;
//   }

//   return `${minutes} : ${seconds}`;
// };
// ////^seconds to seconds:minutes////

// ////duration////
// const onPlayerReady = () => {
//   const durationSec = player.getDuration();

//   $(".player__duration-estimate").text(formatTime(durationSec));
//   if (typeof interval !== "undefined") {
//     clearInterval(interval);
//   }
//   interval = setInterval(() => {
//     const completedSec = player.getCurrentTime();
//     const completedPercent = (completedSec / durationSec) * 100;
//     $(".player__playback-button").css({
//       left: `${completedPercent}%`,
//     });
//     $(".player__duration-completed").text(formatTime(completedSec));
//   }, 1000);
// };
// ////^duration////

// ////playbackButtonMove////
// $(".player__playback").click((e) => {
//   const bar = $(e.currentTarget);
//   const clickedPosition = e.originalEvent.layerX;
//   const newButtonPositionPercent = (clickedPosition / bar.width()) * 100;
//   const newPlaybackPositionSec =
//     (player.getDuration() / 100) * newButtonPositionPercent;

//   $(".player__playback-button").css({
//     left: `${newButtonPositionPercent}%`,
//   });

//   player.seekTo(newPlaybackPositionSec);
// });
// ////^playbackButtonMove////

// function onYouTubeIframeAPIReady() {
//   player = new YT.Player("yt-player", {
//     height: "405",
//     width: "660",
//     videoId: "TxZwqVTaCmA",
//     events: {
//       onReady: onPlayerReady,
//       // onStateChange: onPlayerStateChange
//     },
//     playerVars: {
//       controls: 0,
//       disablekb: 0,
//       shoinfo: 0,
//       rel: 0,
//       autoplay: 0,
//       modestbranding: 0,
//     },
//   });
// }
// let eventsInit = () => {
//   $(".player__start").click((e) => {
//     e.preventDefault();
//     if (playerStart.hasClass("player__start--paused")) {
//       playerStart. oveClass("player__start--paused");
//       playerSplash. oveClass("player__splash--active");
//       player.pauseVideo();
//     } else {
//       playerStart.addClass("player__start--paused");
//       playerSplash.addClass("player__splash--active");
//       player.playVideo();
//     }
//   });
// };
// ////^play/pause////

// eventsInit();

//videoplayer
const player = $("#video-player")[0];
const playerContainer = $(".player");
const playerStart = $(".player__start");
const playerSplash = $(".player__splash");

const formatTime = (timeSec) => {
  const roundTime = Math.round(timeSec);

  const minutes = addZero(Math.floor(roundTime / 60));
  const seconds = addZero(roundTime - minutes * 60);

  function addZero(num) {
    return num < 10 ? `0${num}` : num;
  }

  return `${minutes} : ${seconds}`;
};

const onPlayerReady = () => {
  const durationSec = player.duration;
  console.log(player)

  $(".player__duration-estimate").text(formatTime(durationSec));
  if (typeof interval !== "undefined") {
    clearInterval(interval);
  }
  interval = setInterval(() => {
    const completedSec = player.currentTime;
    const completedPercent = (completedSec / durationSec) * 100;
    $(".player__playback-button").css({
      left: `${completedPercent}%`,
    });
    $(".player__duration-completed").text(formatTime(completedSec));
  }, 1000);
};

$(".player__playback").on('click',(e) => {
  const bar = $(e.currentTarget);
  const clickedPosition = e.originalEvent.layerX;
  const newButtonPositionPercent = (clickedPosition / bar.width()) * 100;
  const newPlaybackPositionSec =
    (player.duration / 100) * newButtonPositionPercent;


  $(".player__playback-button").css({
    left: `${newButtonPositionPercent}%`,
  });

  player.currentTime = newPlaybackPositionSec;
});

let eventsInit = () => {
  $(".player__start").on('click',(e) => {
    e.preventDefault();
    if (playerStart.hasClass("player__start--paused")) {
      playerStart.removeClass("player__start--paused");
      playerSplash.removeClass("player__splash--active");
      player.pause();
    } else {
      playerStart.addClass("player__start--paused");
      playerSplash.addClass("player__splash--active");
      player.play();
    }
  });
};
eventsInit();
onPlayerReady();
// document.addEventListener('DOMContentLoaded', ready);
;const findBlockByAlias = alias =>{
  return $('.reviews__item').filter((ndx,item)=>{
    return $(item).attr('data-linked-with') === alias
  })
}
$('.reviews__link').on('click',e=>{
  e.preventDefault()

  const $this = $(e.currentTarget)
  const target = $this.attr('data-open')
  const itemToShow = findBlockByAlias(target)
  const curItem = $this.closest('.reviews__link')
  itemToShow.addClass('reviews__item--active').siblings().removeClass('reviews__item--active')
  curItem.addClass('reviews__link--active').siblings().removeClass('reviews__link--active')
});let mesure = (content, item) => {
  let titleBox = item.find(".horizontal-slider__title-box");
  let itemsWidth = titleBox.width() * 3;
  const isTablet =
    document.documentElement.clientWidth <= 768 &&
    document.documentElement.clientWidth > 480;
  const isMobile = document.documentElement.clientWidth <= 481;
  if (isTablet) {
    return content.animate({
      width: document.documentElement.clientWidth - itemsWidth,
    });
  }
  if (isMobile) {
    return content.animate({
      width: document.documentElement.clientWidth - titleBox.width(),
    });
  }
  return content.animate({
    width: "520px",
  });
};
$(function () {
  //обрабатываем клик по блоку с классом horizontal-slider__title
  $(".horizontal-slider__title-box").on("click", function (e) {
    e.preventDefault();
    //получаем нужные нам данные
    let $this = $(this),
      //получаем всё блоки list
      container = $this.closest(".horizontal-slider__list"),
      //получаем li по которому кликнули
      item = $this.closest(".horizontal-slider__item"),
      //получаем все другие li
      items = container.find(".horizontal-slider__item"),
      //выбираем из li активный
      activeItem = items.filter(".active"),
      //выбираем из li по которому кликнули блок контен
      content = item.find(".horizontal-slider__content-box"),
      //выбираем у li с классом active блок контент
      activeContent = activeItem.find(".horizontal-slider__content-box");

    //если нет li с классом active по которому кликнули
    if (!item.hasClass("active")) {
      //убираем класс active
      items.removeClass("active");
      //добавляем active кликнутому
      item.addClass("active");
      //у того у кого был active задаём ширину 0
      activeContent.animate({
        width: "0px",
      });
      //кликнутому 530
      mesure(content, item);
      //иначе
    } else {
      item.removeClass("active");
      content.animate({
        width: "0px",
      });
    }
  });

  // клик вне аккордеона
  $(document).on("click", function (e) {
    let $this = $(e.target);
    if (!$this.closest(".horizontal-slider__list").length) {
      $(".horizontal-slider__content-box").animate({
        width: " ",
      });
      $(".horizontal-slider__item").removeClass("active");
    }
  });
});
;const slider = $(".boards__list").bxSlider({
  pager: false,
  controls: false,
});

$(".boards__nav--next").on('click',(e) => {
  e.preventDefault();
  slider.goToNextSlide();
});
$(".boards__nav--prev").on('click',(e) => {
  e.preventDefault();
  slider.goToPrevSlide();
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjY29yZGVvbi5qcyIsImhhbWJ1cmdlci5qcyIsIm1hcC5qcyIsIm1vZGFsLmpzIiwib25lUGFnZVNjcm9sbC5qcyIsInBsYXllci5qcyIsInJldmlld3MuanMiLCJzbGlkZXItbWVudS5qcyIsInNsaWRlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQ3RGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0NoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQzdEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDL0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDbEtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDeEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBvcGVuSXRlbSA9IGl0ZW0gPT57XHJcbmNvbnN0IGNvbnRhaW5lciA9IGl0ZW0uY2xvc2VzdCgnLnRlYW1fX2l0ZW0nKVxyXG5jb25zdCBjb250ZW50QmxvY2sgPSBjb250YWluZXIuZmluZCgnLnRlYW1fX2Fib3V0JylcclxuY29uc3QgdGV4dEJsb2NrID0gY29udGVudEJsb2NrLmZpbmQoJy50ZWFtX19hYm91dC1ibG9jaycpXHJcbmNvbnN0IHJlcUhlaWdodCA9IHRleHRCbG9jay5oZWlnaHQoKVxyXG5jb25zdCBkZXNjUG9seWdvbiA9IGNvbnRhaW5lci5maW5kKCcudGVhbV9fZGVzYycpXHJcbmNvbnRhaW5lci5hZGRDbGFzcygnYWN0aXZlJylcclxuY29udGVudEJsb2NrLmhlaWdodChyZXFIZWlnaHQpXHJcbmRlc2NQb2x5Z29uLmNzcygndHJhbnNmb3JtJywncm90YXRlKDYwZGVnKScpXHJcblxyXG5cclxufVxyXG5jb25zdCBjbG9zZUV2ZXJ5SXRlbSA9IGNvbnRhaW5lciA9PntcclxuICBjb25zdCBpdGVtcyA9IGNvbnRhaW5lci5maW5kKCcudGVhbV9fYWJvdXQnKVxyXG4gIGNvbnN0IGl0ZW1Db250YWluZXIgPSBjb250YWluZXIuZmluZCgnLnRlYW1fX2l0ZW0nKVxyXG4gIGNvbnN0IGRlc2NQb2x5Z29uID0gY29udGFpbmVyLmZpbmQoJy50ZWFtX19kZXNjJylcclxuICBkZXNjUG9seWdvbi5jc3MoJ3RyYW5zZm9ybScsJ3JvdGF0ZSgwZGVnKScpXHJcbiAgaXRlbUNvbnRhaW5lci5yZW1vdmVDbGFzcygnYWN0aXZlJylcclxuICBpdGVtcy5oZWlnaHQoMClcclxufVxyXG4kKCcudGVhbV9fbmFtZScpLm9uKCdjbGljaycsZT0+e1xyXG4gICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpXHJcbiAgLy8gJCgnLnRlYW1fX25hbWUnKS5jc3Moeydjb2xvcic6JyNmZmY5MzQnfSlcclxuICBjb25zdCBjb250YWluZXIgPSAkdGhpcy5jbG9zZXN0KCcudGVhbScpXHJcbiAgY29uc3QgZWxlbUNvbnRhaW5lciA9ICR0aGlzLmNsb3Nlc3QoJy50ZWFtX19pdGVtJylcclxuICBpZiAoZWxlbUNvbnRhaW5lci5oYXNDbGFzcygnYWN0aXZlJykpe1xyXG4gICAgY2xvc2VFdmVyeUl0ZW0oY29udGFpbmVyKVxyXG4gIH1lbHNle1xyXG4gICAgY2xvc2VFdmVyeUl0ZW0oY29udGFpbmVyKVxyXG4gICAgb3Blbkl0ZW0oJHRoaXMpXHJcbiAgXHJcbiAgfVxyXG5cclxuXHJcbn0pIiwibGV0IGhhbWJ1cmdlck1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2J1cmdlck1lbnVcIik7XHJcbmxldCBoYW1idXJnZXJCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2J1cmdlclwiKTtcclxuaGFtYnVyZ2VyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuICBoYW1idXJnZXJCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImJ1cmdlci0tYWN0aXZlXCIpO1xyXG4gIGhhbWJ1cmdlck1lbnUuY2xhc3NMaXN0LnRvZ2dsZShcIm1lbnUtLWFjdGl2ZVwiKTtcclxuICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC50b2dnbGUoXCJmYW5jeWJveC1hY3RpdmVcIik7XHJcbiAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QudG9nZ2xlKFwiY29tcGVuc2F0ZS1mb3Itc2Nyb2xsYmFyXCIpO1xyXG59KTtcclxuXHJcbmxldCBwcmV2QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5ib2FyZHNfX25hdi0tcHJldlwiKTtcclxubGV0IG5leHRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJvYXJkc19fbmF2LS1uZXh0XCIpO1xyXG5sZXQgc2xpZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJvYXJkc1wiKTtcclxuLy8gbmV4dEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xyXG4vLyAgIGUucHJldmVudERlZmF1bHQoKVxyXG4vLyAgIHNsaWRlLmNsYXNzTGlzdC50b2dnbGUoJy5ib2FyZHNfY29udGFpbmVyLS1hY3RpdmUnKVxyXG4vLyB9XHJcblxyXG4vLyApXHJcbi8vIGNvbnNvbGUubG9nKHByZXZCdXR0b24pO1xyXG5cclxuLy8gICBpZiAoXHJcbi8vICAgICBoYW1idXJnZXJCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKFwiYnVyZ2VyLS1hY3RpdmVcIikgPT0gdHJ1ZSAmJlxyXG4vLyAgICAgaGFtYnVyZ2VyTWVudS5jbGFzc0xpc3QuY29udGFpbnMoXCJidXJnZXItLWFjdGl2ZVwiKSA9PSB0cnVlXHJcbi8vICAgKSB7XHJcbi8vICAgICBoYW1idXJnZXJCdXR0b24uY2xhc3NMaXN0LiBvdmUgPT0gXCJidXJnZXItLWFjdGl2ZVwiO1xyXG4vLyAgICAgaGFtYnVyZ2VyTWVudS5jbGFzc0xpc3QuIG92ZSA9PSBcIm1lbnUtLWFjdGl2ZVwiO1xyXG4vLyAgIH0gZWxzZSBpZiAoXHJcbi8vICAgICBoYW1idXJnZXJCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKFwiYnVyZ2VyLS1hY3RpdmVcIikgIT0gdHJ1ZSAmJlxyXG4vLyAgICAgaGFtYnVyZ2VyTWVudS5jbGFzc0xpc3QuY29udGFpbnMoXCJidXJnZXItLWFjdGl2ZVwiKSAhPSB0cnVlXHJcbi8vICAgKSB7XHJcbi8vICAgICAgIGhhbWJ1cmdlckJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiYnVyZ2VyLS1hY3RpdmVcIik7XHJcbi8vICAgICAgIGhhbWJ1cmdlck1lbnUuY2xhc3NMaXN0LmFkZChcIm1lbnUtLWFjdGl2ZVwiKTtcclxuLy8gICB9XHJcbi8vIH0pO1xyXG5cclxuLy8gbGV0IGZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmZvcm1cIik7XHJcbi8vIGxldCBmb3JtRWxlbWVudHMgPSBmb3JtLmVsZW1lbnRzO1xyXG4vLyBsZXQgYnV0dG9uID0gZm9ybUVsZW1lbnRzWzExXTtcclxuXHJcbi8vIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcclxuLy8gICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbi8vICAgbGV0IHVzZXJOYW1lID0gZm9ybUVsZW1lbnRzWzBdLnZhbHVlO1xyXG4vLyAgIGxldCBwaG9uZSA9IGZvcm1FbGVtZW50c1sxXS52YWx1ZTtcclxuLy8gICBsZXQgYWRyZXNzID1cclxuLy8gICAgIFwi0YPQuy4gXCIgK1xyXG4vLyAgICAgZm9ybUVsZW1lbnRzWzJdLnZhbHVlICtcclxuLy8gICAgIFwiIFwiICtcclxuLy8gICAgIFwi0LTQvtC8LiBcIiArXHJcbi8vICAgICBmb3JtRWxlbWVudHNbM10udmFsdWUgK1xyXG4vLyAgICAgXCIgXCIgK1xyXG4vLyAgICAgXCLQutC+0YDQvy5cIiArXHJcbi8vICAgICBmb3JtRWxlbWVudHNbNF0udmFsdWUgK1xyXG4vLyAgICAgXCIgXCIgK1xyXG4vLyAgICAgXCLQutCyLiBcIiArXHJcbi8vICAgICBmb3JtRWxlbWVudHNbNV0udmFsdWUgK1xyXG4vLyAgICAgXCIgXCIgK1xyXG4vLyAgICAgXCLRjdGCLiBcIiArXHJcbi8vICAgICBmb3JtRWxlbWVudHNbNl0udmFsdWU7XHJcbi8vICAgbGV0IGNvbW1lbnQgPSBmb3JtRWxlbWVudHNbN10udmFsdWU7XHJcbi8vICAgaWYgKGZvcm1FbGVtZW50c1s4XS5jaGVja2VkID09IHRydWUpIHtcclxuLy8gICAgIHBheW1hbnQgPSBcItCe0L/Qu9Cw0YLQsCDQvdCw0LvQuNGH0L3Ri9C80LhcIjtcclxuLy8gICB9IGVsc2Uge1xyXG4vLyAgICAgcGF5bWFudCA9IFwi0J7Qv9C70LDRgtCwINC60LDRgNGC0L7QuVwiO1xyXG4vLyAgIH1cclxuLy8gICBhbGVydCh1c2VyTmFtZSArIHBob25lICsgXCIgXCIgKyBhZHJlc3MgKyBcIiBcIiArIHBheW1hbnQgKyBcIiBcIiArIGNvbW1lbnQpO1xyXG4vLyAgIGNvbnNvbGUubG9nKGZvcm1FbGVtZW50cyk7XHJcbi8vICAgY29uc29sZS5sb2codXNlck5hbWUsIHBob25lLCBhZHJlc3MsIHBheW1hbnQsIGNvbW1lbnQpO1xyXG4vLyB9KTtcclxuLy8gJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xyXG4vLyAgICQoXCIuZm9ybV9fYnRuXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcclxuLy8gICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuLy8gICAgIGxldCBmb3JtVGl0bGUgPSAkKFwiLmZvcm1fX3RpdGxlXCIpO1xyXG4vLyAgICAgbGV0IGZvcm1JbnB1dCA9ICQoXCIuZm9ybV9faW5wdXRcIik7XHJcbi8vICAgICAvLyAkLmVhY2goZm9ybVRpdGxlKSwobmR4LCBpdGVtICkgPT57XHJcbi8vICAgICAvLyAgIGxldCBmb3JtVGl0bGVFbGVtZW50cz0gJChpdGVtKVtuZHhdLmlubmVyVGV4dFxyXG4vLyAgICAgLy8gICBjb25zb2xlLmxvZyhmb3JtVGl0bGVFbGVtZW50cylcclxuLy8gICAgIC8vIH1cclxuLy8gICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9ybVRpdGxlLmxlbmd0aDsgaSsrKSB7XHJcbi8vICAgICAgIGxldCBmb3JtVGl0bGVFbGVtZW50cyA9IGZvcm1UaXRsZVtpXS5pbm5lclRleHQ7XHJcbi8vICAgICAgIGxldCBmb3JtSW5wdXRWYWx1ZXMgPSAkKGZvcm1JbnB1dFtpICsgMV0pLnZhbCgpO1xyXG4vLyAgICAgICBsZXQgcmVzdWx0ID0gZm9ybVRpdGxlRWxlbWVudHMgKyBcIjogXCIgKyBmb3JtSW5wdXRWYWx1ZXM7XHJcbi8vICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcbi8vICAgICB9XHJcbi8vICAgfSk7XHJcbi8vIH0pO1xyXG4iLCJsZXQgbXlNYXA7XHJcblxyXG5jb25zdCBpbml0ID0gKCkgPT4ge1xyXG4gIG15TWFwID0gbmV3IHltYXBzLk1hcChcIm1hcFwiLCB7XHJcbiAgICBjZW50ZXI6IFs1OS45MzUyNzQsIDMwLjMxMjM4OF0sXHJcbiAgICB6b29tOiAxMSxcclxuICB9KTtcclxuICBjb25zdCBjb29yZHMgPSBbXHJcbiAgICBbNTkuOTQ1NTQzMjc5ODkyODcsIDMwLjM4OTM1MjYyMTE0NjY4XSxcclxuICAgIFs1OS45MTE0MjMyMzU2MzkwOSwgMzAuNTAwMjQ1ODcwNjU4NDFdLFxyXG4gICAgWzU5Ljg4NjkzMTYxNzg0NjA2LCAzMC4zMTk2NTgxMDIxMDM3MTNdLFxyXG4gICAgWzU5Ljk3MDMzNTc0ODIxNjcyLCAzMC4zMTUxOTQ5MDYzMDI5MjRdLFxyXG4gIF07XHJcbiAgY29uc3QgbXlDb2xsZWN0aW9uID0gbmV3IHltYXBzLkdlb09iamVjdENvbGxlY3Rpb24oXHJcbiAgICB7fSxcclxuICAgIHtcclxuICAgICAgZHJhZ2dhYmxlOiBmYWxzZSxcclxuICAgICAgaWNvbkxheW91dDogXCJkZWZhdWx0I2ltYWdlXCIsXHJcbiAgICAgIGljb25JbWFnZUhyZWY6IFwiLi9pbWcvbWFya2VyLnN2Z1wiLFxyXG4gICAgICBpY29uSW1hZ2VTaXplOiBbNDYsIDU3XSxcclxuICAgICAgaWNvbkltYWdlT2Zmc2V0OiBbLTM1LCAtNTJdLFxyXG4gICAgfVxyXG4gICk7XHJcbiAgY29vcmRzLmZvckVhY2goKGNvb3JkKSA9PiB7XHJcbiAgICBteUNvbGxlY3Rpb24uYWRkKG5ldyB5bWFwcy5QbGFjZW1hcmsoY29vcmQpKTtcclxuICB9KTtcclxuXHJcbiAgbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlDb2xsZWN0aW9uKTtcclxuICBteU1hcC5iZWhhdmlvcnMuZGlzYWJsZShcInNjcm9sbFpvb21cIik7XHJcbn07XHJcblxyXG55bWFwcy5yZWFkeShpbml0KTtcclxuIiwiY29uc3QgdmFsaWRhdGVGaWVsZHMgPSAoZm9ybSwgZmllbGRzQXJyYXkpID0+IHtcclxuICBmaWVsZHNBcnJheS5mb3JFYWNoKChmaWVsZCkgPT4ge1xyXG4gICAgZmllbGQucmVtb3ZlQ2xhc3MoXCJpbnB1dC1lcnJvclwiKTtcclxuICAgIGlmIChmaWVsZC52YWwoKS50cmltKCkgPT09IFwiXCIpIHtcclxuICAgICAgZmllbGQuYWRkQ2xhc3MoXCJpbnB1dC1lcnJvclwiKTtcclxuICAgIH1cclxuICB9KTtcclxuICBjb25zdCBlcnJvckZpZWxkcyA9IGZvcm0uZmluZChcIi5pbnB1dC1lcnJvclwiKTtcclxuICByZXR1cm4gZXJyb3JGaWVsZHMubGVuZ3RoID09PSAwO1xyXG59O1xyXG5cclxuJChcIi5mb3JtX19idG5cIikub24oJ2NsaWNrJywoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgY29uc3QgZm9ybSA9ICQoXCIuZm9ybVwiKTtcclxuICBjb25zdCBuYW1lID0gZm9ybS5maW5kKFwiW25hbWUgPSAnbmFtZSddXCIpO1xyXG4gIGNvbnN0IHBob25lID0gZm9ybS5maW5kKFwiW25hbWUgPSAncGhvbmUnXVwiKTtcclxuICBjb25zdCBjb21tZW50ID0gZm9ybS5maW5kKFwiLmZvcm1fX2lucHV0LS10ZXh0YXJlYVwiKTtcclxuICBjb25zdCB0byA9IGZvcm0uZmluZChcIltuYW1lID0gJ3RvJ11cIik7XHJcbiAgY29uc3QgY29udGVudCA9ICQoXCIubW9kYWxfX2NvbnRlbnRcIik7XHJcbiAgaXNWYWxpZCA9IHZhbGlkYXRlRmllbGRzKGZvcm0sIFtuYW1lLCBwaG9uZSwgY29tbWVudCwgdG9dKTtcclxuXHJcbiAgaWYgKGlzVmFsaWQpIHtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSAkLmFqYXgoe1xyXG4gICAgICB1cmw6IFwiaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsXCIsXHJcbiAgICAgIG1ldGhvZDogXCJwb3N0XCIsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICBuYW1lOiBuYW1lLnZhbCgpLFxyXG4gICAgICAgIHBob25lOiBwaG9uZS52YWwoKSxcclxuICAgICAgICBjb21tZW50OiBjb21tZW50LnZhbCgpLFxyXG4gICAgICAgIHRvOiB0by52YWwoKSxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gICAgcmVxdWVzdC5kb25lKChkYXRhKSA9PiB7XHJcbiAgICAgIGNvbnRlbnQucmVtb3ZlQ2xhc3MoXCJlcnJvci10ZXh0XCIpO1xyXG4gICAgICBjb250ZW50LnRleHQoZGF0YS5tZXNzYWdlKTtcclxuICAgIH0pO1xyXG4gICAgcmVxdWVzdC5mYWlsKChkYXRhKSA9PiB7XHJcbiAgICAgIGxldCBtZXNzYWdlO1xyXG4gICAgICBpZihkYXRhPy5yZXNwb25zZUpTT04/Lm1lc3NhZ2Upe1xyXG4gICAgICAgIG1lc3NhZ2UgPSByZXNwb25zZUpTT04ubWVzc2FnZVxyXG4gICAgICB9ZWxzZXtcclxuICAgICAgICBtZXNzYWdlID0gJ9Cf0YDQvtC40LfQvtGI0LvQsCDQvtGI0LjQsdC60LAs0L/QvtC/0YDQvtCx0YPQudGC0LUg0L/QvtC30LbQtSdcclxuICAgICAgfVxyXG4gICAgICBjb250ZW50LnRleHQobWVzc2FnZSk7XHJcbiAgICAgIGNvbnRlbnQuYWRkQ2xhc3MoXCJlcnJvci10ZXh0XCIpO1xyXG4gICAgfSk7XHJcbiAgICByZXF1ZXN0LmFsd2F5cygoKSA9PiB7XHJcbiAgICAgJC5mYW5jeWJveC5vcGVuKHtcclxuICAgICAgc3JjOicjZm9ybS1tb2RhbCcsXHJcbiAgICAgIHR5cGU6J2lubGluZScsXHJcbiAgICAgfSlcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4kKFwiLmJ0bi0tY2xvc2VcIikub24oJ2NsaWNrJywoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuICAkLmZhbmN5Ym94LmNsb3NlKClcclxuICAvLyAkKFwiLmZvcm0tbW9kYWxcIikuY3NzKHsgaGVpZ2h0OiBcIjAlXCIsIHdpZHRoOiBcIjAlXCIgfSk7XHJcbn0pO1xyXG4iLCJcclxuLy9tZXRob2RzXHJcbi8vICQuZm4uZnVsbHBhZ2Uuc2V0QWxsb3dTY3JvbGxpbmcoZmFsc2UpO1xyXG5cclxubGV0IGRvRnVsbHBhZ2UgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGg7XHJcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcclxuICAvL9GH0YLQviDQsdGLINC90LUg0YDQsNCx0L7RgtCw0Lsg0L3QsCDQvNC+0LHQuNC70LrQsNGFXHJcbiAgLy8gaWYgKGRvRnVsbHBhZ2UgPiA3NjgpIHtcclxuICAgICQoXCIjZnVsbHBhZ2VcIikuZnVsbHBhZ2Uoe1xyXG4gICAgICAvL29wdGlvbnMgaGVyZVxyXG4gICAgICBzY3JvbGxPdmVyZmxvdzogZmFsc2UsXHJcbiAgICAgIGF1dG9TY3JvbGxpbmc6IHRydWUsXHJcbiAgICAgIHNjcm9sbEhvcml6b250YWxseTogdHJ1ZSxcclxuICAgICAgdmVydGljYWxDZW50ZXJlZDogZmFsc2UsXHJcbiAgICAgIGZpdFRvU2VjdGlvbjogZmFsc2UsXHJcbiAgICAgIG5hdmlnYXRpb246IHRydWUsXHJcbiAgICAgIC8vIGFuY2hvcnM6Wycjd2h5JywgJyNib2FyZHMnLCAnI3Jldmlld3MnXSxcclxuICAgICAgc2Nyb2xsT3ZlcmZsb3c6IGZhbHNlLFxyXG5cclxuICAgICAgLy8gZml4ZWRFbGVtZW50czooJy5oZWFkZXInKVxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuKTtcclxuJChcIltkYXRhLXNjcm9sbC10b11cIikub24oJ2NsaWNrJywoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCB0YXJnZXQgPSAkdGhpcy5hdHRyKFwiZGF0YS1zY3JvbGwtdG9cIik7XHJcbiAgY29uc3QgcmVxU2VjdGlvbiA9ICQoYFtkYXRhLXNlY3Rpb24taWQgPSAke3RhcmdldH1dYCk7XHJcblxyXG4gIHBlcmZvcm1UcmFuc2l0aW9uKHJlcVNlY3Rpb24uaW5kZXgoKSk7XHJcbn0pO1xyXG5cclxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLy9cclxuXHJcbmNvbnN0IHNlY3Rpb25zID0gJChcInNlY3Rpb25cIik7XHJcbmNvbnN0IGRpc3BsYXkgPSAkKFwiLm1haW5jb250ZW50XCIpO1xyXG5sZXQgaW5TY3JvbGwgPSBmYWxzZTtcclxuc2VjdGlvbnMuZmlyc3QoKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcclxuXHJcbmNvbnN0IHBlcmZvcm1UcmFuc2l0aW9uID0gKHNlY3Rpb25FcSkgPT4ge1xyXG4gIGlmIChpblNjcm9sbCA9PT0gZmFsc2UpIHtcclxuICAgIGluU2Nyb2xsID0gdHJ1ZTtcclxuICAgIGNvbnN0IHBvc2l0aW9uID0gc2VjdGlvbkVxICogLTEwMDtcclxuICAgIGRpc3BsYXkuY3NzKHtcclxuICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWSgke3Bvc2l0aW9ufSUpYCxcclxuICAgIH0pO1xyXG4gICAgc2VjdGlvbnMuZXEoc2VjdGlvbkVxKS5hZGRDbGFzcyhcImFjdGl2ZVwiKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGluU2Nyb2xsID0gZmFsc2U7XHJcbiAgICB9LCA4MDApO1xyXG4gIH1cclxufTtcclxuLy8gY29uc3Qgdmlld3BvcnRTY3JvbGxlciA9ICgpID0+IHtcclxuLy8gICBjb25zdCBhY3RpdmVTZWN0aW9uID0gc2VjdGlvbnMuZmlsdGVyKFwiLmFjdGl2ZVwiKTtcclxuLy8gICBjb25zdCBuZXh0U2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24ubmV4dCgpO1xyXG4vLyAgIGNvbnN0IHByZXZTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5wcmV2KCk7XHJcbi8vICAgcmV0dXJuIHtcclxuLy8gICAgIG5leHQoKSB7XHJcbi8vICAgICAgIGlmIChuZXh0U2VjdGlvbi5sZW5ndGgpIHtcclxuLy8gICAgICAgICBwZXJmb3JtVHJhbnNpdGlvbihuZXh0U2VjdGlvbi5pbmRleCgpKTtcclxuLy8gICAgICAgfVxyXG4vLyAgICAgfSxcclxuLy8gICAgIHByZXYoKSB7XHJcbi8vICAgICAgIGlmIChwcmV2U2VjdGlvbi5sZW5ndGgpIHtcclxuLy8gICAgICAgICBwZXJmb3JtVHJhbnNpdGlvbihwcmV2U2VjdGlvbi5pbmRleCgpKTtcclxuLy8gICAgICAgfVxyXG4vLyAgICAgfSxcclxuLy8gICB9O1xyXG4vLyB9O1xyXG4vLyAkKHdpbmRvdykub24oXCJ3aGVlbFwiLCAoZSkgPT4ge1xyXG4vLyAgIGNvbnN0IGRlbHRhWSA9IGUub3JpZ2luYWxFdmVudC5kZWx0YVk7XHJcbi8vICAgY29uc3Qgc2Nyb2xsZXIgPSB2aWV3cG9ydFNjcm9sbGVyKCk7XHJcbi8vICAgLy8gbGV0IG1hcCA9ICQoJy5tYXAnKVxyXG4vLyAgIC8vIGNvbnNvbGUubG9nKG1hcClcclxuLy8gICBpZiAoZGVsdGFZID4gMCkge1xyXG4vLyAgICAgLy8mJiBlLnRhcmdldCAhPSBtYXBcclxuLy8gICAgIC8vbmV4dFxyXG4vLyAgICAgc2Nyb2xsZXIubmV4dCgpO1xyXG4vLyAgIH1cclxuLy8gICBpZiAoZGVsdGFZIDwgMCkge1xyXG4vLyAgICAgLy9wcmV2XHJcbi8vICAgICBzY3JvbGxlci5wcmV2KCk7XHJcbi8vICAgfVxyXG4vLyB9KTtcclxuLy8gJCh3aW5kb3cpLm9uKFwia2V5ZG93blwiLCAoZSkgPT4ge1xyXG4vLyAgIGNvbnN0IHRhZ05hbWUgPSBlLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XHJcbi8vICAgY29uc3Qgc2Nyb2xsZXIgPSB2aWV3cG9ydFNjcm9sbGVyKCk7XHJcbi8vICAgaWYgKHRhZ05hbWUgIT0gXCJ0ZXh0YXJlYVwiICYmIHRhZ05hbWUgIT0gXCJpbnB1dFwiKSB7XHJcbi8vICAgICBzd2l0Y2ggKGUua2V5KSB7XHJcbi8vICAgICAgIGNhc2UgMzg6XHJcbi8vICAgICAgICAgc2Nyb2xsZXIucHJldigpO1xyXG4vLyAgICAgICAgIGJyZWFrO1xyXG4vLyAgICAgICBjYXNlIDQwOlxyXG4vLyAgICAgICAgIHNjcm9sbGVyLm5leHQoKTtcclxuLy8gICAgICAgICBicmVhaztcclxuLy8gICAgIH1cclxuLy8gICB9XHJcbi8vIH0pO1xyXG5cclxuLy8gJChcIltkYXRhLXNjcm9sbC10b11cIikub24oJ2NsaWNrJywoZSkgPT4ge1xyXG4vLyAgIGUucHJldmVudERlZmF1bHQoKTtcclxuLy8gICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuLy8gICBjb25zdCB0YXJnZXQgPSAkdGhpcy5hdHRyKFwiZGF0YS1zY3JvbGwtdG9cIik7XHJcbi8vICAgY29uc3QgcmVxU2VjdGlvbiA9ICQoYFtkYXRhLXNlY3Rpb24taWQgPSAke3RhcmdldH1dYCk7XHJcblxyXG4vLyAgIHBlcmZvcm1UcmFuc2l0aW9uKHJlcVNlY3Rpb24uaW5kZXgoKSk7XHJcbi8vIH0pO1xyXG5cclxuLy8gLy9odHRwczovL2dpdGh1Yi5jb20vbWF0dGJyeXNvbi9Ub3VjaFN3aXBlLUpxdWVyeS1QbHVnaW5cclxuLy8gJChmdW5jdGlvbiAoKSB7XHJcbi8vICAgJChcImJvZHlcIikuc3dpcGUoe1xyXG5cclxuLy8gICAgIC8vR2VuZXJpYyBzd2lwZSBoYW5kbGVyIGZvciBhbGwgZGlyZWN0aW9uc1xyXG4vLyAgICAgc3dpcGU6IGZ1bmN0aW9uIChldmVudCwgZGlyZWN0aW9uKSB7XHJcbi8vICAgICAgIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG4vLyAgICAgICBsZXQgc2Nyb2xsRGlyZWN0aW9uID0gXCJcIjtcclxuLy8gICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gXCJ1cFwiKSB7XHJcbi8vICAgICAgICAgc2Nyb2xsRGlyZWN0aW9uID0gXCJuZXh0XCI7XHJcbi8vICAgICAgIH1cclxuLy8gICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gXCJkb3duXCIpIHtcclxuLy8gICAgICAgICBzY3JvbGxEaXJlY3Rpb24gPSBcInByZXZcIjtcclxuLy8gICAgICAgfVxyXG4vLyAgICAgICBzY3JvbGxlcltzY3JvbGxEaXJlY3Rpb25dKCk7XHJcbi8vICAgICB9LFxyXG4vLyAgIH0pO1xyXG4vLyB9KTtcclxuIiwiLy8gbGV0IHBsYXllcjtcclxuLy8gY29uc3QgcGxheWVyQ29udGFpbmVyID0gJChcIi5wbGF5ZXJcIik7XHJcbi8vIGNvbnN0IHBsYXllclN0YXJ0ID0gJChcIi5wbGF5ZXJfX3N0YXJ0XCIpO1xyXG4vLyBjb25zdCBwbGF5ZXJTcGxhc2ggPSAkKFwiLnBsYXllcl9fc3BsYXNoXCIpO1xyXG4vLyAvLy8vcGxheS9wYXVzZS8vLy9cclxuXHJcbi8vIC8vLy9zZWNvbmRzIHRvIHNlY29uZHM6bWludXRlcy8vLy9cclxuLy8gY29uc3QgZm9ybWF0VGltZSA9ICh0aW1lU2VjKSA9PiB7XHJcbi8vICAgY29uc3Qgcm91bmRUaW1lID0gTWF0aC5yb3VuZCh0aW1lU2VjKTtcclxuXHJcbi8vICAgY29uc3QgbWludXRlcyA9IGFkZFplcm8oTWF0aC5mbG9vcihyb3VuZFRpbWUgLyA2MCkpO1xyXG4vLyAgIGNvbnN0IHNlY29uZHMgPSBhZGRaZXJvKHJvdW5kVGltZSAtIG1pbnV0ZXMgKiA2MCk7XHJcblxyXG4vLyAgIGZ1bmN0aW9uIGFkZFplcm8obnVtKSB7XHJcbi8vICAgICByZXR1cm4gbnVtIDwgMTAgPyBgMCR7bnVtfWAgOiBudW07XHJcbi8vICAgfVxyXG5cclxuLy8gICByZXR1cm4gYCR7bWludXRlc30gOiAke3NlY29uZHN9YDtcclxuLy8gfTtcclxuLy8gLy8vL15zZWNvbmRzIHRvIHNlY29uZHM6bWludXRlcy8vLy9cclxuXHJcbi8vIC8vLy9kdXJhdGlvbi8vLy9cclxuLy8gY29uc3Qgb25QbGF5ZXJSZWFkeSA9ICgpID0+IHtcclxuLy8gICBjb25zdCBkdXJhdGlvblNlYyA9IHBsYXllci5nZXREdXJhdGlvbigpO1xyXG5cclxuLy8gICAkKFwiLnBsYXllcl9fZHVyYXRpb24tZXN0aW1hdGVcIikudGV4dChmb3JtYXRUaW1lKGR1cmF0aW9uU2VjKSk7XHJcbi8vICAgaWYgKHR5cGVvZiBpbnRlcnZhbCAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4vLyAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XHJcbi8vICAgfVxyXG4vLyAgIGludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4vLyAgICAgY29uc3QgY29tcGxldGVkU2VjID0gcGxheWVyLmdldEN1cnJlbnRUaW1lKCk7XHJcbi8vICAgICBjb25zdCBjb21wbGV0ZWRQZXJjZW50ID0gKGNvbXBsZXRlZFNlYyAvIGR1cmF0aW9uU2VjKSAqIDEwMDtcclxuLy8gICAgICQoXCIucGxheWVyX19wbGF5YmFjay1idXR0b25cIikuY3NzKHtcclxuLy8gICAgICAgbGVmdDogYCR7Y29tcGxldGVkUGVyY2VudH0lYCxcclxuLy8gICAgIH0pO1xyXG4vLyAgICAgJChcIi5wbGF5ZXJfX2R1cmF0aW9uLWNvbXBsZXRlZFwiKS50ZXh0KGZvcm1hdFRpbWUoY29tcGxldGVkU2VjKSk7XHJcbi8vICAgfSwgMTAwMCk7XHJcbi8vIH07XHJcbi8vIC8vLy9eZHVyYXRpb24vLy8vXHJcblxyXG4vLyAvLy8vcGxheWJhY2tCdXR0b25Nb3ZlLy8vL1xyXG4vLyAkKFwiLnBsYXllcl9fcGxheWJhY2tcIikuY2xpY2soKGUpID0+IHtcclxuLy8gICBjb25zdCBiYXIgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbi8vICAgY29uc3QgY2xpY2tlZFBvc2l0aW9uID0gZS5vcmlnaW5hbEV2ZW50LmxheWVyWDtcclxuLy8gICBjb25zdCBuZXdCdXR0b25Qb3NpdGlvblBlcmNlbnQgPSAoY2xpY2tlZFBvc2l0aW9uIC8gYmFyLndpZHRoKCkpICogMTAwO1xyXG4vLyAgIGNvbnN0IG5ld1BsYXliYWNrUG9zaXRpb25TZWMgPVxyXG4vLyAgICAgKHBsYXllci5nZXREdXJhdGlvbigpIC8gMTAwKSAqIG5ld0J1dHRvblBvc2l0aW9uUGVyY2VudDtcclxuXHJcbi8vICAgJChcIi5wbGF5ZXJfX3BsYXliYWNrLWJ1dHRvblwiKS5jc3Moe1xyXG4vLyAgICAgbGVmdDogYCR7bmV3QnV0dG9uUG9zaXRpb25QZXJjZW50fSVgLFxyXG4vLyAgIH0pO1xyXG5cclxuLy8gICBwbGF5ZXIuc2Vla1RvKG5ld1BsYXliYWNrUG9zaXRpb25TZWMpO1xyXG4vLyB9KTtcclxuLy8gLy8vL15wbGF5YmFja0J1dHRvbk1vdmUvLy8vXHJcblxyXG4vLyBmdW5jdGlvbiBvbllvdVR1YmVJZnJhbWVBUElSZWFkeSgpIHtcclxuLy8gICBwbGF5ZXIgPSBuZXcgWVQuUGxheWVyKFwieXQtcGxheWVyXCIsIHtcclxuLy8gICAgIGhlaWdodDogXCI0MDVcIixcclxuLy8gICAgIHdpZHRoOiBcIjY2MFwiLFxyXG4vLyAgICAgdmlkZW9JZDogXCJUeFp3cVZUYUNtQVwiLFxyXG4vLyAgICAgZXZlbnRzOiB7XHJcbi8vICAgICAgIG9uUmVhZHk6IG9uUGxheWVyUmVhZHksXHJcbi8vICAgICAgIC8vIG9uU3RhdGVDaGFuZ2U6IG9uUGxheWVyU3RhdGVDaGFuZ2VcclxuLy8gICAgIH0sXHJcbi8vICAgICBwbGF5ZXJWYXJzOiB7XHJcbi8vICAgICAgIGNvbnRyb2xzOiAwLFxyXG4vLyAgICAgICBkaXNhYmxla2I6IDAsXHJcbi8vICAgICAgIHNob2luZm86IDAsXHJcbi8vICAgICAgIHJlbDogMCxcclxuLy8gICAgICAgYXV0b3BsYXk6IDAsXHJcbi8vICAgICAgIG1vZGVzdGJyYW5kaW5nOiAwLFxyXG4vLyAgICAgfSxcclxuLy8gICB9KTtcclxuLy8gfVxyXG4vLyBsZXQgZXZlbnRzSW5pdCA9ICgpID0+IHtcclxuLy8gICAkKFwiLnBsYXllcl9fc3RhcnRcIikuY2xpY2soKGUpID0+IHtcclxuLy8gICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuLy8gICAgIGlmIChwbGF5ZXJTdGFydC5oYXNDbGFzcyhcInBsYXllcl9fc3RhcnQtLXBhdXNlZFwiKSkge1xyXG4vLyAgICAgICBwbGF5ZXJTdGFydC4gb3ZlQ2xhc3MoXCJwbGF5ZXJfX3N0YXJ0LS1wYXVzZWRcIik7XHJcbi8vICAgICAgIHBsYXllclNwbGFzaC4gb3ZlQ2xhc3MoXCJwbGF5ZXJfX3NwbGFzaC0tYWN0aXZlXCIpO1xyXG4vLyAgICAgICBwbGF5ZXIucGF1c2VWaWRlbygpO1xyXG4vLyAgICAgfSBlbHNlIHtcclxuLy8gICAgICAgcGxheWVyU3RhcnQuYWRkQ2xhc3MoXCJwbGF5ZXJfX3N0YXJ0LS1wYXVzZWRcIik7XHJcbi8vICAgICAgIHBsYXllclNwbGFzaC5hZGRDbGFzcyhcInBsYXllcl9fc3BsYXNoLS1hY3RpdmVcIik7XHJcbi8vICAgICAgIHBsYXllci5wbGF5VmlkZW8oKTtcclxuLy8gICAgIH1cclxuLy8gICB9KTtcclxuLy8gfTtcclxuLy8gLy8vL15wbGF5L3BhdXNlLy8vL1xyXG5cclxuLy8gZXZlbnRzSW5pdCgpO1xyXG5cclxuLy92aWRlb3BsYXllclxyXG5jb25zdCBwbGF5ZXIgPSAkKFwiI3ZpZGVvLXBsYXllclwiKVswXTtcclxuY29uc3QgcGxheWVyQ29udGFpbmVyID0gJChcIi5wbGF5ZXJcIik7XHJcbmNvbnN0IHBsYXllclN0YXJ0ID0gJChcIi5wbGF5ZXJfX3N0YXJ0XCIpO1xyXG5jb25zdCBwbGF5ZXJTcGxhc2ggPSAkKFwiLnBsYXllcl9fc3BsYXNoXCIpO1xyXG5cclxuY29uc3QgZm9ybWF0VGltZSA9ICh0aW1lU2VjKSA9PiB7XHJcbiAgY29uc3Qgcm91bmRUaW1lID0gTWF0aC5yb3VuZCh0aW1lU2VjKTtcclxuXHJcbiAgY29uc3QgbWludXRlcyA9IGFkZFplcm8oTWF0aC5mbG9vcihyb3VuZFRpbWUgLyA2MCkpO1xyXG4gIGNvbnN0IHNlY29uZHMgPSBhZGRaZXJvKHJvdW5kVGltZSAtIG1pbnV0ZXMgKiA2MCk7XHJcblxyXG4gIGZ1bmN0aW9uIGFkZFplcm8obnVtKSB7XHJcbiAgICByZXR1cm4gbnVtIDwgMTAgPyBgMCR7bnVtfWAgOiBudW07XHJcbiAgfVxyXG5cclxuICByZXR1cm4gYCR7bWludXRlc30gOiAke3NlY29uZHN9YDtcclxufTtcclxuXHJcbmNvbnN0IG9uUGxheWVyUmVhZHkgPSAoKSA9PiB7XHJcbiAgY29uc3QgZHVyYXRpb25TZWMgPSBwbGF5ZXIuZHVyYXRpb247XHJcbiAgY29uc29sZS5sb2cocGxheWVyKVxyXG5cclxuICAkKFwiLnBsYXllcl9fZHVyYXRpb24tZXN0aW1hdGVcIikudGV4dChmb3JtYXRUaW1lKGR1cmF0aW9uU2VjKSk7XHJcbiAgaWYgKHR5cGVvZiBpbnRlcnZhbCAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XHJcbiAgfVxyXG4gIGludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgY29uc3QgY29tcGxldGVkU2VjID0gcGxheWVyLmN1cnJlbnRUaW1lO1xyXG4gICAgY29uc3QgY29tcGxldGVkUGVyY2VudCA9IChjb21wbGV0ZWRTZWMgLyBkdXJhdGlvblNlYykgKiAxMDA7XHJcbiAgICAkKFwiLnBsYXllcl9fcGxheWJhY2stYnV0dG9uXCIpLmNzcyh7XHJcbiAgICAgIGxlZnQ6IGAke2NvbXBsZXRlZFBlcmNlbnR9JWAsXHJcbiAgICB9KTtcclxuICAgICQoXCIucGxheWVyX19kdXJhdGlvbi1jb21wbGV0ZWRcIikudGV4dChmb3JtYXRUaW1lKGNvbXBsZXRlZFNlYykpO1xyXG4gIH0sIDEwMDApO1xyXG59O1xyXG5cclxuJChcIi5wbGF5ZXJfX3BsYXliYWNrXCIpLm9uKCdjbGljaycsKGUpID0+IHtcclxuICBjb25zdCBiYXIgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgY29uc3QgY2xpY2tlZFBvc2l0aW9uID0gZS5vcmlnaW5hbEV2ZW50LmxheWVyWDtcclxuICBjb25zdCBuZXdCdXR0b25Qb3NpdGlvblBlcmNlbnQgPSAoY2xpY2tlZFBvc2l0aW9uIC8gYmFyLndpZHRoKCkpICogMTAwO1xyXG4gIGNvbnN0IG5ld1BsYXliYWNrUG9zaXRpb25TZWMgPVxyXG4gICAgKHBsYXllci5kdXJhdGlvbiAvIDEwMCkgKiBuZXdCdXR0b25Qb3NpdGlvblBlcmNlbnQ7XHJcblxyXG5cclxuICAkKFwiLnBsYXllcl9fcGxheWJhY2stYnV0dG9uXCIpLmNzcyh7XHJcbiAgICBsZWZ0OiBgJHtuZXdCdXR0b25Qb3NpdGlvblBlcmNlbnR9JWAsXHJcbiAgfSk7XHJcblxyXG4gIHBsYXllci5jdXJyZW50VGltZSA9IG5ld1BsYXliYWNrUG9zaXRpb25TZWM7XHJcbn0pO1xyXG5cclxubGV0IGV2ZW50c0luaXQgPSAoKSA9PiB7XHJcbiAgJChcIi5wbGF5ZXJfX3N0YXJ0XCIpLm9uKCdjbGljaycsKGUpID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGlmIChwbGF5ZXJTdGFydC5oYXNDbGFzcyhcInBsYXllcl9fc3RhcnQtLXBhdXNlZFwiKSkge1xyXG4gICAgICBwbGF5ZXJTdGFydC5yZW1vdmVDbGFzcyhcInBsYXllcl9fc3RhcnQtLXBhdXNlZFwiKTtcclxuICAgICAgcGxheWVyU3BsYXNoLnJlbW92ZUNsYXNzKFwicGxheWVyX19zcGxhc2gtLWFjdGl2ZVwiKTtcclxuICAgICAgcGxheWVyLnBhdXNlKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBwbGF5ZXJTdGFydC5hZGRDbGFzcyhcInBsYXllcl9fc3RhcnQtLXBhdXNlZFwiKTtcclxuICAgICAgcGxheWVyU3BsYXNoLmFkZENsYXNzKFwicGxheWVyX19zcGxhc2gtLWFjdGl2ZVwiKTtcclxuICAgICAgcGxheWVyLnBsYXkoKTtcclxuICAgIH1cclxuICB9KTtcclxufTtcclxuZXZlbnRzSW5pdCgpO1xyXG5vblBsYXllclJlYWR5KCk7XHJcbi8vIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCByZWFkeSk7XHJcbiIsImNvbnN0IGZpbmRCbG9ja0J5QWxpYXMgPSBhbGlhcyA9PntcclxuICByZXR1cm4gJCgnLnJldmlld3NfX2l0ZW0nKS5maWx0ZXIoKG5keCxpdGVtKT0+e1xyXG4gICAgcmV0dXJuICQoaXRlbSkuYXR0cignZGF0YS1saW5rZWQtd2l0aCcpID09PSBhbGlhc1xyXG4gIH0pXHJcbn1cclxuJCgnLnJldmlld3NfX2xpbmsnKS5vbignY2xpY2snLGU9PntcclxuICBlLnByZXZlbnREZWZhdWx0KClcclxuXHJcbiAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldClcclxuICBjb25zdCB0YXJnZXQgPSAkdGhpcy5hdHRyKCdkYXRhLW9wZW4nKVxyXG4gIGNvbnN0IGl0ZW1Ub1Nob3cgPSBmaW5kQmxvY2tCeUFsaWFzKHRhcmdldClcclxuICBjb25zdCBjdXJJdGVtID0gJHRoaXMuY2xvc2VzdCgnLnJldmlld3NfX2xpbmsnKVxyXG4gIGl0ZW1Ub1Nob3cuYWRkQ2xhc3MoJ3Jldmlld3NfX2l0ZW0tLWFjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ3Jldmlld3NfX2l0ZW0tLWFjdGl2ZScpXHJcbiAgY3VySXRlbS5hZGRDbGFzcygncmV2aWV3c19fbGluay0tYWN0aXZlJykuc2libGluZ3MoKS5yZW1vdmVDbGFzcygncmV2aWV3c19fbGluay0tYWN0aXZlJylcclxufSkiLCJsZXQgbWVzdXJlID0gKGNvbnRlbnQsIGl0ZW0pID0+IHtcclxuICBsZXQgdGl0bGVCb3ggPSBpdGVtLmZpbmQoXCIuaG9yaXpvbnRhbC1zbGlkZXJfX3RpdGxlLWJveFwiKTtcclxuICBsZXQgaXRlbXNXaWR0aCA9IHRpdGxlQm94LndpZHRoKCkgKiAzO1xyXG4gIGNvbnN0IGlzVGFibGV0ID1cclxuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCA8PSA3NjggJiZcclxuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCA+IDQ4MDtcclxuICBjb25zdCBpc01vYmlsZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCA8PSA0ODE7XHJcbiAgaWYgKGlzVGFibGV0KSB7XHJcbiAgICByZXR1cm4gY29udGVudC5hbmltYXRlKHtcclxuICAgICAgd2lkdGg6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCAtIGl0ZW1zV2lkdGgsXHJcbiAgICB9KTtcclxuICB9XHJcbiAgaWYgKGlzTW9iaWxlKSB7XHJcbiAgICByZXR1cm4gY29udGVudC5hbmltYXRlKHtcclxuICAgICAgd2lkdGg6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCAtIHRpdGxlQm94LndpZHRoKCksXHJcbiAgICB9KTtcclxuICB9XHJcbiAgcmV0dXJuIGNvbnRlbnQuYW5pbWF0ZSh7XHJcbiAgICB3aWR0aDogXCI1MjBweFwiLFxyXG4gIH0pO1xyXG59O1xyXG4kKGZ1bmN0aW9uICgpIHtcclxuICAvL9C+0LHRgNCw0LHQsNGC0YvQstCw0LXQvCDQutC70LjQuiDQv9C+INCx0LvQvtC60YMg0YEg0LrQu9Cw0YHRgdC+0LwgaG9yaXpvbnRhbC1zbGlkZXJfX3RpdGxlXHJcbiAgJChcIi5ob3Jpem9udGFsLXNsaWRlcl9fdGl0bGUtYm94XCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIC8v0L/QvtC70YPRh9Cw0LXQvCDQvdGD0LbQvdGL0LUg0L3QsNC8INC00LDQvdC90YvQtVxyXG4gICAgbGV0ICR0aGlzID0gJCh0aGlzKSxcclxuICAgICAgLy/Qv9C+0LvRg9GH0LDQtdC8INCy0YHRkSDQsdC70L7QutC4IGxpc3RcclxuICAgICAgY29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi5ob3Jpem9udGFsLXNsaWRlcl9fbGlzdFwiKSxcclxuICAgICAgLy/Qv9C+0LvRg9GH0LDQtdC8IGxpINC/0L4g0LrQvtGC0L7RgNC+0LzRgyDQutC70LjQutC90YPQu9C4XHJcbiAgICAgIGl0ZW0gPSAkdGhpcy5jbG9zZXN0KFwiLmhvcml6b250YWwtc2xpZGVyX19pdGVtXCIpLFxyXG4gICAgICAvL9C/0L7Qu9GD0YfQsNC10Lwg0LLRgdC1INC00YDRg9Cz0LjQtSBsaVxyXG4gICAgICBpdGVtcyA9IGNvbnRhaW5lci5maW5kKFwiLmhvcml6b250YWwtc2xpZGVyX19pdGVtXCIpLFxyXG4gICAgICAvL9Cy0YvQsdC40YDQsNC10Lwg0LjQtyBsaSDQsNC60YLQuNCy0L3Ri9C5XHJcbiAgICAgIGFjdGl2ZUl0ZW0gPSBpdGVtcy5maWx0ZXIoXCIuYWN0aXZlXCIpLFxyXG4gICAgICAvL9Cy0YvQsdC40YDQsNC10Lwg0LjQtyBsaSDQv9C+INC60L7RgtC+0YDQvtC80YMg0LrQu9C40LrQvdGD0LvQuCDQsdC70L7QuiDQutC+0L3RgtC10L1cclxuICAgICAgY29udGVudCA9IGl0ZW0uZmluZChcIi5ob3Jpem9udGFsLXNsaWRlcl9fY29udGVudC1ib3hcIiksXHJcbiAgICAgIC8v0LLRi9Cx0LjRgNCw0LXQvCDRgyBsaSDRgSDQutC70LDRgdGB0L7QvCBhY3RpdmUg0LHQu9C+0Log0LrQvtC90YLQtdC90YJcclxuICAgICAgYWN0aXZlQ29udGVudCA9IGFjdGl2ZUl0ZW0uZmluZChcIi5ob3Jpem9udGFsLXNsaWRlcl9fY29udGVudC1ib3hcIik7XHJcblxyXG4gICAgLy/QtdGB0LvQuCDQvdC10YIgbGkg0YEg0LrQu9Cw0YHRgdC+0LwgYWN0aXZlINC/0L4g0LrQvtGC0L7RgNC+0LzRgyDQutC70LjQutC90YPQu9C4XHJcbiAgICBpZiAoIWl0ZW0uaGFzQ2xhc3MoXCJhY3RpdmVcIikpIHtcclxuICAgICAgLy/Rg9Cx0LjRgNCw0LXQvCDQutC70LDRgdGBIGFjdGl2ZVxyXG4gICAgICBpdGVtcy5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcclxuICAgICAgLy/QtNC+0LHQsNCy0LvRj9C10LwgYWN0aXZlINC60LvQuNC60L3Rg9GC0L7QvNGDXHJcbiAgICAgIGl0ZW0uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICAgIC8v0YMg0YLQvtCz0L4g0YMg0LrQvtCz0L4g0LHRi9C7IGFjdGl2ZSDQt9Cw0LTQsNGR0Lwg0YjQuNGA0LjQvdGDIDBcclxuICAgICAgYWN0aXZlQ29udGVudC5hbmltYXRlKHtcclxuICAgICAgICB3aWR0aDogXCIwcHhcIixcclxuICAgICAgfSk7XHJcbiAgICAgIC8v0LrQu9C40LrQvdGD0YLQvtC80YMgNTMwXHJcbiAgICAgIG1lc3VyZShjb250ZW50LCBpdGVtKTtcclxuICAgICAgLy/QuNC90LDRh9C1XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpdGVtLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgICBjb250ZW50LmFuaW1hdGUoe1xyXG4gICAgICAgIHdpZHRoOiBcIjBweFwiLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgLy8g0LrQu9C40Log0LLQvdC1INCw0LrQutC+0YDQtNC10L7QvdCwXHJcbiAgJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgbGV0ICR0aGlzID0gJChlLnRhcmdldCk7XHJcbiAgICBpZiAoISR0aGlzLmNsb3Nlc3QoXCIuaG9yaXpvbnRhbC1zbGlkZXJfX2xpc3RcIikubGVuZ3RoKSB7XHJcbiAgICAgICQoXCIuaG9yaXpvbnRhbC1zbGlkZXJfX2NvbnRlbnQtYm94XCIpLmFuaW1hdGUoe1xyXG4gICAgICAgIHdpZHRoOiBcIiBcIixcclxuICAgICAgfSk7XHJcbiAgICAgICQoXCIuaG9yaXpvbnRhbC1zbGlkZXJfX2l0ZW1cIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn0pO1xyXG4iLCJjb25zdCBzbGlkZXIgPSAkKFwiLmJvYXJkc19fbGlzdFwiKS5ieFNsaWRlcih7XHJcbiAgcGFnZXI6IGZhbHNlLFxyXG4gIGNvbnRyb2xzOiBmYWxzZSxcclxufSk7XHJcblxyXG4kKFwiLmJvYXJkc19fbmF2LS1uZXh0XCIpLm9uKCdjbGljaycsKGUpID0+IHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgc2xpZGVyLmdvVG9OZXh0U2xpZGUoKTtcclxufSk7XHJcbiQoXCIuYm9hcmRzX19uYXYtLXByZXZcIikub24oJ2NsaWNrJywoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuICBzbGlkZXIuZ29Ub1ByZXZTbGlkZSgpO1xyXG59KTtcclxuIl19
