const openItem = item =>{
const container = item.closest('.team__item')
const contentBlock = container.find('.team__about')
const textBlock = contentBlock.find('.team__about-block')
const reqHeight = textBlock.height()
const descPolygon = container.find('.team__desc')
container.addClass('active')
contentBlock.height(reqHeight)
descPolygon.css('transform','rotate(60deg)')


}
const closeEveryItem = container =>{
  const items = container.find('.team__about')
  const itemContainer = container.find('.team__item')
  const descPolygon = container.find('.team__desc')
  descPolygon.css('transform','rotate(0deg)')
  itemContainer.removeClass('active')
  items.height(0)
}
$('.team__name').on('click',e=>{
  $this = $(e.currentTarget)
  // $('.team__name').css({'color':'#fff934'})
  const container = $this.closest('.team')
  const elemContainer = $this.closest('.team__item')
  if (elemContainer.hasClass('active')){
    closeEveryItem(container)
  }else{
    closeEveryItem(container)
    openItem($this)
  
  }


});let hamburgerMenu = document.querySelector("#burgerMenu");
let hamburgerButton = document.querySelector("#burger");
hamburgerButton.addEventListener("click", function (e) {
  e.preventDefault();
  hamburgerButton.classList.toggle("burger--active");
  hamburgerMenu.classList.toggle("menu--active");
  document.body.classList.toggle("fancybox-active");
  document.body.classList.toggle("compensate-for-scrollbar");
});

let prevButton = document.querySelector(".boards__nav--prev");
let nextButton = document.querySelector(".boards__nav--next");
let slide = document.querySelector(".boards");
// nextButton.addEventListener('click', function(e){
//   e.preventDefault()
//   slide.classList.toggle('.boards_container--active')
// }

// )
// console.log(prevButton);

//   if (
//     hamburgerButton.classList.contains("burger--active") == true &&
//     hamburgerMenu.classList.contains("burger--active") == true
//   ) {
//     hamburgerButton.classList. ove == "burger--active";
//     hamburgerMenu.classList. ove == "menu--active";
//   } else if (
//     hamburgerButton.classList.contains("burger--active") != true &&
//     hamburgerMenu.classList.contains("burger--active") != true
//   ) {
//       hamburgerButton.classList.add("burger--active");
//       hamburgerMenu.classList.add("menu--active");
//   }
// });

// let form = document.querySelector(".form");
// let formElements = form.elements;
// let button = formElements[11];

// button.addEventListener("click", function (e) {
//   e.preventDefault();
//   let userName = formElements[0].value;
//   let phone = formElements[1].value;
//   let adress =
//     "ул. " +
//     formElements[2].value +
//     " " +
//     "дом. " +
//     formElements[3].value +
//     " " +
//     "корп." +
//     formElements[4].value +
//     " " +
//     "кв. " +
//     formElements[5].value +
//     " " +
//     "эт. " +
//     formElements[6].value;
//   let comment = formElements[7].value;
//   if (formElements[8].checked == true) {
//     paymant = "Оплата наличными";
//   } else {
//     paymant = "Оплата картой";
//   }
//   alert(userName + phone + " " + adress + " " + paymant + " " + comment);
//   console.log(formElements);
//   console.log(userName, phone, adress, paymant, comment);
// });
// $(document).ready(() => {
//   $(".form__btn").on("click", (e) => {
//     e.preventDefault();
//     let formTitle = $(".form__title");
//     let formInput = $(".form__input");
//     // $.each(formTitle),(ndx, item ) =>{
//     //   let formTitleElements= $(item)[ndx].innerText
//     //   console.log(formTitleElements)
//     // }
//     for (let i = 0; i < formTitle.length; i++) {
//       let formTitleElements = formTitle[i].innerText;
//       let formInputValues = $(formInput[i + 1]).val();
//       let result = formTitleElements + ": " + formInputValues;
//       console.log(result);
//     }
//   });
// });
;let myMap;

const init = () => {
  myMap = new ymaps.Map("map", {
    center: [59.935274, 30.312388],
    zoom: 11,
  });
  const coords = [
    [59.94554327989287, 30.38935262114668],
    [59.91142323563909, 30.50024587065841],
    [59.88693161784606, 30.319658102103713],
    [59.97033574821672, 30.315194906302924],
  ];
  const myCollection = new ymaps.GeoObjectCollection(
    {},
    {
      draggable: false,
      iconLayout: "default#image",
      iconImageHref: "./img/marker.svg",
      iconImageSize: [46, 57],
      iconImageOffset: [-35, -52],
    }
  );
  coords.forEach((coord) => {
    myCollection.add(new ymaps.Placemark(coord));
  });

  myMap.geoObjects.add(myCollection);
  myMap.behaviors.disable("scrollZoom");
};

ymaps.ready(init);
;const validateFields = (form, fieldsArray) => {
  fieldsArray.forEach((field) => {
    field.removeClass("input-error");
    if (field.val().trim() === "") {
      field.addClass("input-error");
    }
  });
  const errorFields = form.find(".input-error");
  return errorFields.length === 0;
};

$(".form__btn").on('click',(e) => {
  e.preventDefault();

  const form = $(".form");
  const name = form.find("[name = 'name']");
  const phone = form.find("[name = 'phone']");
  const comment = form.find(".form__input--textarea");
  const to = form.find("[name = 'to']");
  const content = $(".modal__content");
  isValid = validateFields(form, [name, phone, comment, to]);

  if (isValid) {
    const request = $.ajax({
      url: "https://webdev-api.loftschool.com/sendmail",
      method: "post",
      data: {
        name: name.val(),
        phone: phone.val(),
        comment: comment.val(),
        to: to.val(),
      },
    });
    request.done((data) => {
      content.removeClass("error-text");
      content.text(data.message);
    });
    request.fail((data) => {
      let message;
      if(data?.responseJSON?.message){
        message = responseJSON.message
      }else{
        message = 'Произошла ошибка,попробуйте позже'
      }
      content.text(message);
      content.addClass("error-text");
    });
    request.always(() => {
     $.fancybox.open({
      src:'#form-modal',
      type:'inline',
     })
    });
  }
});

$(".btn--close").on('click',(e) => {
  e.preventDefault();
  $.fancybox.close()
  // $(".form-modal").css({ height: "0%", width: "0%" });
});
;
//methods
// $.fn.fullpage.setAllowScrolling(false);

let doFullpage = document.documentElement.clientWidth;
$(document).ready(function () {
  //что бы не работал на мобилках
  // if (doFullpage > 768) {
    $("#fullpage").fullpage({
      //options here
      scrollOverflow: false,
      autoScrolling: true,
      scrollHorizontally: true,
      verticalCentered: false,
      fitToSection: false,
      navigation: true,
      // anchors:['#why', '#boards', '#reviews'],
      scrollOverflow: false,

      // fixedElements:('.header')
    });

  }
);
$("[data-scroll-to]").on('click',(e) => {
  e.preventDefault();
  const $this = $(e.currentTarget);
  const target = $this.attr("data-scroll-to");
  const reqSection = $(`[data-section-id = ${target}]`);

  performTransition(reqSection.index());
});

//----------------------------------------------------------------------------------------------------------//

const sections = $("section");
const display = $(".maincontent");
let inScroll = false;
sections.first().addClass("active");

const performTransition = (sectionEq) => {
  if (inScroll === false) {
    inScroll = true;
    const position = sectionEq * -100;
    display.css({
      transform: `translateY(${position}%)`,
    });
    sections.eq(sectionEq).addClass("active").siblings().removeClass("active");
    setTimeout(() => {
      inScroll = false;
    }, 800);
  }
};
// const viewportScroller = () => {
//   const activeSection = sections.filter(".active");
//   const nextSection = activeSection.next();
//   const prevSection = activeSection.prev();
//   return {
//     next() {
//       if (nextSection.length) {
//         performTransition(nextSection.index());
//       }
//     },
//     prev() {
//       if (prevSection.length) {
//         performTransition(prevSection.index());
//       }
//     },
//   };
// };
// $(window).on("wheel", (e) => {
//   const deltaY = e.originalEvent.deltaY;
//   const scroller = viewportScroller();
//   // let map = $('.map')
//   // console.log(map)
//   if (deltaY > 0) {
//     //&& e.target != map
//     //next
//     scroller.next();
//   }
//   if (deltaY < 0) {
//     //prev
//     scroller.prev();
//   }
// });
// $(window).on("keydown", (e) => {
//   const tagName = e.target.tagName.toLowerCase();
//   const scroller = viewportScroller();
//   if (tagName != "textarea" && tagName != "input") {
//     switch (e.key) {
//       case 38:
//         scroller.prev();
//         break;
//       case 40:
//         scroller.next();
//         break;
//     }
//   }
// });

// $("[data-scroll-to]").on('click',(e) => {
//   e.preventDefault();
//   const $this = $(e.currentTarget);
//   const target = $this.attr("data-scroll-to");
//   const reqSection = $(`[data-section-id = ${target}]`);

//   performTransition(reqSection.index());
// });

// //https://github.com/mattbryson/TouchSwipe-Jquery-Plugin
// $(function () {
//   $("body").swipe({

//     //Generic swipe handler for all directions
//     swipe: function (event, direction) {
//       const scroller = viewportScroller();
//       let scrollDirection = "";
//       if (direction === "up") {
//         scrollDirection = "next";
//       }
//       if (direction === "down") {
//         scrollDirection = "prev";
//       }
//       scroller[scrollDirection]();
//     },
//   });
// });
;// let player;
// const playerContainer = $(".player");
// const playerStart = $(".player__start");
// const playerSplash = $(".player__splash");
// ////play/pause////

// ////seconds to seconds:minutes////
// const formatTime = (timeSec) => {
//   const roundTime = Math.round(timeSec);

//   const minutes = addZero(Math.floor(roundTime / 60));
//   const seconds = addZero(roundTime - minutes * 60);

//   function addZero(num) {
//     return num < 10 ? `0${num}` : num;
//   }

//   return `${minutes} : ${seconds}`;
// };
// ////^seconds to seconds:minutes////

// ////duration////
// const onPlayerReady = () => {
//   const durationSec = player.getDuration();

//   $(".player__duration-estimate").text(formatTime(durationSec));
//   if (typeof interval !== "undefined") {
//     clearInterval(interval);
//   }
//   interval = setInterval(() => {
//     const completedSec = player.getCurrentTime();
//     const completedPercent = (completedSec / durationSec) * 100;
//     $(".player__playback-button").css({
//       left: `${completedPercent}%`,
//     });
//     $(".player__duration-completed").text(formatTime(completedSec));
//   }, 1000);
// };
// ////^duration////

// ////playbackButtonMove////
// $(".player__playback").click((e) => {
//   const bar = $(e.currentTarget);
//   const clickedPosition = e.originalEvent.layerX;
//   const newButtonPositionPercent = (clickedPosition / bar.width()) * 100;
//   const newPlaybackPositionSec =
//     (player.getDuration() / 100) * newButtonPositionPercent;

//   $(".player__playback-button").css({
//     left: `${newButtonPositionPercent}%`,
//   });

//   player.seekTo(newPlaybackPositionSec);
// });
// ////^playbackButtonMove////

// function onYouTubeIframeAPIReady() {
//   player = new YT.Player("yt-player", {
//     height: "405",
//     width: "660",
//     videoId: "TxZwqVTaCmA",
//     events: {
//       onReady: onPlayerReady,
//       // onStateChange: onPlayerStateChange
//     },
//     playerVars: {
//       controls: 0,
//       disablekb: 0,
//       shoinfo: 0,
//       rel: 0,
//       autoplay: 0,
//       modestbranding: 0,
//     },
//   });
// }
// let eventsInit = () => {
//   $(".player__start").click((e) => {
//     e.preventDefault();
//     if (playerStart.hasClass("player__start--paused")) {
//       playerStart. oveClass("player__start--paused");
//       playerSplash. oveClass("player__splash--active");
//       player.pauseVideo();
//     } else {
//       playerStart.addClass("player__start--paused");
//       playerSplash.addClass("player__splash--active");
//       player.playVideo();
//     }
//   });
// };
// ////^play/pause////

// eventsInit();

//videoplayer
const player = $("#video-player")[0];
const playerContainer = $(".player");
const playerStart = $(".player__start");
const playerSplash = $(".player__splash");
const volumeButton = $('.player__volume-button')
const volumePayback = $('.player__volume')
let interval;
let videoDuration = 0;

player.addEventListener('loadeddata',() =>{
  videoDuration = player.duration
  $(".player__duration-estimate").text(formatTime(videoDuration));
})
volumeButton.addEventListener('click',console.log(volumeButton))

// const soundOf = ()=>{
//   console.log(volumeButton)
// }
const formatTime = (timeSec) => {
  const roundTime = Math.round(timeSec);

  const minutes = addZero(Math.floor(roundTime / 60));
  const seconds = addZero(roundTime - minutes * 60);

  function addZero(num) {
    return num < 10 ? `0${num}` : num;
  }

  return `${minutes} : ${seconds}`;
};

const onPlayerReady = () => {



  if (typeof interval !== "undefined") {
    clearInterval(interval);
  }
  interval = setInterval(() => {
    const completedSec = player.currentTime;
    const completedPercent = (completedSec / videoDuration) * 100;
    $(".player__playback-button").css({
      left: `${completedPercent}%`,
    });
    $(".player__duration-completed").text(formatTime(completedSec));
  }, 1000);
};

$(".player__playback").on('click',(e) => {
  const bar = $(e.currentTarget);
  const clickedPosition = e.originalEvent.layerX;
  const newButtonPositionPercent = (clickedPosition / bar.width()) * 100;
  const newPlaybackPositionSec =
    (player.duration / 100) * newButtonPositionPercent;


  $(".player__playback-button").css({
    left: `${newButtonPositionPercent}%`,
  });

  player.currentTime = newPlaybackPositionSec;
});

let eventsInit = () => {
  $(".player__start").on('click',(e) => {
    e.preventDefault();
    if (playerStart.hasClass("player__start--paused")) {
      playerStart.removeClass("player__start--paused");
      playerSplash.removeClass("player__splash--active");
      player.pause();
    } else {
      playerStart.addClass("player__start--paused");
      playerSplash.addClass("player__splash--active");
      player.play();
    }
  });
};

eventsInit();
onPlayerReady();
// document.addEventListener('DOMContentLoaded', ready);
;const findBlockByAlias = alias =>{
  return $('.reviews__item').filter((ndx,item)=>{
    return $(item).attr('data-linked-with') === alias
  })
}
$('.reviews__link').on('click',e=>{
  e.preventDefault()

  const $this = $(e.currentTarget)
  const target = $this.attr('data-open')
  const itemToShow = findBlockByAlias(target)
  const curItem = $this.closest('.reviews__link')
  itemToShow.addClass('reviews__item--active').siblings().removeClass('reviews__item--active')
  curItem.addClass('reviews__link--active').siblings().removeClass('reviews__link--active')
});let mesure = (content, item) => {
  let titleBox = item.find(".horizontal-slider__title-box");
  let itemsWidth = titleBox.width() * 3;
  const isTablet =
    document.documentElement.clientWidth <= 768 &&
    document.documentElement.clientWidth > 480;
  const isMobile = document.documentElement.clientWidth <= 481;
  if (isTablet) {
    return content.animate({
      width: document.documentElement.clientWidth - itemsWidth,
    });
  }
  if (isMobile) {
    return content.animate({
      width: document.documentElement.clientWidth - titleBox.width(),
    });
  }
  return content.animate({
    width: "520px",
  });
};
$(function () {
  //обрабатываем клик по блоку с классом horizontal-slider__title
  $(".horizontal-slider__title-box").on("click", function (e) {
    e.preventDefault();
    //получаем нужные нам данные
    let $this = $(this),
      //получаем всё блоки list
      container = $this.closest(".horizontal-slider__list"),
      //получаем li по которому кликнули
      item = $this.closest(".horizontal-slider__item"),
      //получаем все другие li
      items = container.find(".horizontal-slider__item"),
      //выбираем из li активный
      activeItem = items.filter(".active"),
      //выбираем из li по которому кликнули блок контен
      content = item.find(".horizontal-slider__content-box"),
      //выбираем у li с классом active блок контент
      activeContent = activeItem.find(".horizontal-slider__content-box");

    //если нет li с классом active по которому кликнули
    if (!item.hasClass("active")) {
      //убираем класс active
      items.removeClass("active");
      //добавляем active кликнутому
      item.addClass("active");
      //у того у кого был active задаём ширину 0
      activeContent.animate({
        width: "0px",
      });
      //кликнутому 530
      mesure(content, item);
      //иначе
    } else {
      item.removeClass("active");
      content.animate({
        width: "0px",
      });
    }
  });

  // клик вне аккордеона
  $(document).on("click", function (e) {
    let $this = $(e.target);
    if (!$this.closest(".horizontal-slider__list").length) {
      $(".horizontal-slider__content-box").animate({
        width: " ",
      });
      $(".horizontal-slider__item").removeClass("active");
    }
  });
});
;const slider = $(".boards__list").bxSlider({
  pager: false,
  controls: false,
});

$(".boards__nav--next").on('click',(e) => {
  e.preventDefault();
  slider.goToNextSlide();
});
$(".boards__nav--prev").on('click',(e) => {
  e.preventDefault();
  slider.goToPrevSlide();
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjY29yZGVvbi5qcyIsImhhbWJ1cmdlci5qcyIsIm1hcC5qcyIsIm1vZGFsLmpzIiwib25lUGFnZVNjcm9sbC5qcyIsInBsYXllci5qcyIsInJldmlld3MuanMiLCJzbGlkZXItbWVudS5qcyIsInNsaWRlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQ3RGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0NoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQzdEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDL0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0MvS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0N4RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG9wZW5JdGVtID0gaXRlbSA9PntcclxuY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KCcudGVhbV9faXRlbScpXHJcbmNvbnN0IGNvbnRlbnRCbG9jayA9IGNvbnRhaW5lci5maW5kKCcudGVhbV9fYWJvdXQnKVxyXG5jb25zdCB0ZXh0QmxvY2sgPSBjb250ZW50QmxvY2suZmluZCgnLnRlYW1fX2Fib3V0LWJsb2NrJylcclxuY29uc3QgcmVxSGVpZ2h0ID0gdGV4dEJsb2NrLmhlaWdodCgpXHJcbmNvbnN0IGRlc2NQb2x5Z29uID0gY29udGFpbmVyLmZpbmQoJy50ZWFtX19kZXNjJylcclxuY29udGFpbmVyLmFkZENsYXNzKCdhY3RpdmUnKVxyXG5jb250ZW50QmxvY2suaGVpZ2h0KHJlcUhlaWdodClcclxuZGVzY1BvbHlnb24uY3NzKCd0cmFuc2Zvcm0nLCdyb3RhdGUoNjBkZWcpJylcclxuXHJcblxyXG59XHJcbmNvbnN0IGNsb3NlRXZlcnlJdGVtID0gY29udGFpbmVyID0+e1xyXG4gIGNvbnN0IGl0ZW1zID0gY29udGFpbmVyLmZpbmQoJy50ZWFtX19hYm91dCcpXHJcbiAgY29uc3QgaXRlbUNvbnRhaW5lciA9IGNvbnRhaW5lci5maW5kKCcudGVhbV9faXRlbScpXHJcbiAgY29uc3QgZGVzY1BvbHlnb24gPSBjb250YWluZXIuZmluZCgnLnRlYW1fX2Rlc2MnKVxyXG4gIGRlc2NQb2x5Z29uLmNzcygndHJhbnNmb3JtJywncm90YXRlKDBkZWcpJylcclxuICBpdGVtQ29udGFpbmVyLnJlbW92ZUNsYXNzKCdhY3RpdmUnKVxyXG4gIGl0ZW1zLmhlaWdodCgwKVxyXG59XHJcbiQoJy50ZWFtX19uYW1lJykub24oJ2NsaWNrJyxlPT57XHJcbiAgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldClcclxuICAvLyAkKCcudGVhbV9fbmFtZScpLmNzcyh7J2NvbG9yJzonI2ZmZjkzNCd9KVxyXG4gIGNvbnN0IGNvbnRhaW5lciA9ICR0aGlzLmNsb3Nlc3QoJy50ZWFtJylcclxuICBjb25zdCBlbGVtQ29udGFpbmVyID0gJHRoaXMuY2xvc2VzdCgnLnRlYW1fX2l0ZW0nKVxyXG4gIGlmIChlbGVtQ29udGFpbmVyLmhhc0NsYXNzKCdhY3RpdmUnKSl7XHJcbiAgICBjbG9zZUV2ZXJ5SXRlbShjb250YWluZXIpXHJcbiAgfWVsc2V7XHJcbiAgICBjbG9zZUV2ZXJ5SXRlbShjb250YWluZXIpXHJcbiAgICBvcGVuSXRlbSgkdGhpcylcclxuICBcclxuICB9XHJcblxyXG5cclxufSkiLCJsZXQgaGFtYnVyZ2VyTWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYnVyZ2VyTWVudVwiKTtcclxubGV0IGhhbWJ1cmdlckJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYnVyZ2VyXCIpO1xyXG5oYW1idXJnZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGhhbWJ1cmdlckJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiYnVyZ2VyLS1hY3RpdmVcIik7XHJcbiAgaGFtYnVyZ2VyTWVudS5jbGFzc0xpc3QudG9nZ2xlKFwibWVudS0tYWN0aXZlXCIpO1xyXG4gIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnRvZ2dsZShcImZhbmN5Ym94LWFjdGl2ZVwiKTtcclxuICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC50b2dnbGUoXCJjb21wZW5zYXRlLWZvci1zY3JvbGxiYXJcIik7XHJcbn0pO1xyXG5cclxubGV0IHByZXZCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJvYXJkc19fbmF2LS1wcmV2XCIpO1xyXG5sZXQgbmV4dEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYm9hcmRzX19uYXYtLW5leHRcIik7XHJcbmxldCBzbGlkZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYm9hcmRzXCIpO1xyXG4vLyBuZXh0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSl7XHJcbi8vICAgZS5wcmV2ZW50RGVmYXVsdCgpXHJcbi8vICAgc2xpZGUuY2xhc3NMaXN0LnRvZ2dsZSgnLmJvYXJkc19jb250YWluZXItLWFjdGl2ZScpXHJcbi8vIH1cclxuXHJcbi8vIClcclxuLy8gY29uc29sZS5sb2cocHJldkJ1dHRvbik7XHJcblxyXG4vLyAgIGlmIChcclxuLy8gICAgIGhhbWJ1cmdlckJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoXCJidXJnZXItLWFjdGl2ZVwiKSA9PSB0cnVlICYmXHJcbi8vICAgICBoYW1idXJnZXJNZW51LmNsYXNzTGlzdC5jb250YWlucyhcImJ1cmdlci0tYWN0aXZlXCIpID09IHRydWVcclxuLy8gICApIHtcclxuLy8gICAgIGhhbWJ1cmdlckJ1dHRvbi5jbGFzc0xpc3QuIG92ZSA9PSBcImJ1cmdlci0tYWN0aXZlXCI7XHJcbi8vICAgICBoYW1idXJnZXJNZW51LmNsYXNzTGlzdC4gb3ZlID09IFwibWVudS0tYWN0aXZlXCI7XHJcbi8vICAgfSBlbHNlIGlmIChcclxuLy8gICAgIGhhbWJ1cmdlckJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoXCJidXJnZXItLWFjdGl2ZVwiKSAhPSB0cnVlICYmXHJcbi8vICAgICBoYW1idXJnZXJNZW51LmNsYXNzTGlzdC5jb250YWlucyhcImJ1cmdlci0tYWN0aXZlXCIpICE9IHRydWVcclxuLy8gICApIHtcclxuLy8gICAgICAgaGFtYnVyZ2VyQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJidXJnZXItLWFjdGl2ZVwiKTtcclxuLy8gICAgICAgaGFtYnVyZ2VyTWVudS5jbGFzc0xpc3QuYWRkKFwibWVudS0tYWN0aXZlXCIpO1xyXG4vLyAgIH1cclxuLy8gfSk7XHJcblxyXG4vLyBsZXQgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybVwiKTtcclxuLy8gbGV0IGZvcm1FbGVtZW50cyA9IGZvcm0uZWxlbWVudHM7XHJcbi8vIGxldCBidXR0b24gPSBmb3JtRWxlbWVudHNbMTFdO1xyXG5cclxuLy8gYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4vLyAgIGUucHJldmVudERlZmF1bHQoKTtcclxuLy8gICBsZXQgdXNlck5hbWUgPSBmb3JtRWxlbWVudHNbMF0udmFsdWU7XHJcbi8vICAgbGV0IHBob25lID0gZm9ybUVsZW1lbnRzWzFdLnZhbHVlO1xyXG4vLyAgIGxldCBhZHJlc3MgPVxyXG4vLyAgICAgXCLRg9C7LiBcIiArXHJcbi8vICAgICBmb3JtRWxlbWVudHNbMl0udmFsdWUgK1xyXG4vLyAgICAgXCIgXCIgK1xyXG4vLyAgICAgXCLQtNC+0LwuIFwiICtcclxuLy8gICAgIGZvcm1FbGVtZW50c1szXS52YWx1ZSArXHJcbi8vICAgICBcIiBcIiArXHJcbi8vICAgICBcItC60L7RgNC/LlwiICtcclxuLy8gICAgIGZvcm1FbGVtZW50c1s0XS52YWx1ZSArXHJcbi8vICAgICBcIiBcIiArXHJcbi8vICAgICBcItC60LIuIFwiICtcclxuLy8gICAgIGZvcm1FbGVtZW50c1s1XS52YWx1ZSArXHJcbi8vICAgICBcIiBcIiArXHJcbi8vICAgICBcItGN0YIuIFwiICtcclxuLy8gICAgIGZvcm1FbGVtZW50c1s2XS52YWx1ZTtcclxuLy8gICBsZXQgY29tbWVudCA9IGZvcm1FbGVtZW50c1s3XS52YWx1ZTtcclxuLy8gICBpZiAoZm9ybUVsZW1lbnRzWzhdLmNoZWNrZWQgPT0gdHJ1ZSkge1xyXG4vLyAgICAgcGF5bWFudCA9IFwi0J7Qv9C70LDRgtCwINC90LDQu9C40YfQvdGL0LzQuFwiO1xyXG4vLyAgIH0gZWxzZSB7XHJcbi8vICAgICBwYXltYW50ID0gXCLQntC/0LvQsNGC0LAg0LrQsNGA0YLQvtC5XCI7XHJcbi8vICAgfVxyXG4vLyAgIGFsZXJ0KHVzZXJOYW1lICsgcGhvbmUgKyBcIiBcIiArIGFkcmVzcyArIFwiIFwiICsgcGF5bWFudCArIFwiIFwiICsgY29tbWVudCk7XHJcbi8vICAgY29uc29sZS5sb2coZm9ybUVsZW1lbnRzKTtcclxuLy8gICBjb25zb2xlLmxvZyh1c2VyTmFtZSwgcGhvbmUsIGFkcmVzcywgcGF5bWFudCwgY29tbWVudCk7XHJcbi8vIH0pO1xyXG4vLyAkKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XHJcbi8vICAgJChcIi5mb3JtX19idG5cIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xyXG4vLyAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4vLyAgICAgbGV0IGZvcm1UaXRsZSA9ICQoXCIuZm9ybV9fdGl0bGVcIik7XHJcbi8vICAgICBsZXQgZm9ybUlucHV0ID0gJChcIi5mb3JtX19pbnB1dFwiKTtcclxuLy8gICAgIC8vICQuZWFjaChmb3JtVGl0bGUpLChuZHgsIGl0ZW0gKSA9PntcclxuLy8gICAgIC8vICAgbGV0IGZvcm1UaXRsZUVsZW1lbnRzPSAkKGl0ZW0pW25keF0uaW5uZXJUZXh0XHJcbi8vICAgICAvLyAgIGNvbnNvbGUubG9nKGZvcm1UaXRsZUVsZW1lbnRzKVxyXG4vLyAgICAgLy8gfVxyXG4vLyAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmb3JtVGl0bGUubGVuZ3RoOyBpKyspIHtcclxuLy8gICAgICAgbGV0IGZvcm1UaXRsZUVsZW1lbnRzID0gZm9ybVRpdGxlW2ldLmlubmVyVGV4dDtcclxuLy8gICAgICAgbGV0IGZvcm1JbnB1dFZhbHVlcyA9ICQoZm9ybUlucHV0W2kgKyAxXSkudmFsKCk7XHJcbi8vICAgICAgIGxldCByZXN1bHQgPSBmb3JtVGl0bGVFbGVtZW50cyArIFwiOiBcIiArIGZvcm1JbnB1dFZhbHVlcztcclxuLy8gICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcclxuLy8gICAgIH1cclxuLy8gICB9KTtcclxuLy8gfSk7XHJcbiIsImxldCBteU1hcDtcclxuXHJcbmNvbnN0IGluaXQgPSAoKSA9PiB7XHJcbiAgbXlNYXAgPSBuZXcgeW1hcHMuTWFwKFwibWFwXCIsIHtcclxuICAgIGNlbnRlcjogWzU5LjkzNTI3NCwgMzAuMzEyMzg4XSxcclxuICAgIHpvb206IDExLFxyXG4gIH0pO1xyXG4gIGNvbnN0IGNvb3JkcyA9IFtcclxuICAgIFs1OS45NDU1NDMyNzk4OTI4NywgMzAuMzg5MzUyNjIxMTQ2NjhdLFxyXG4gICAgWzU5LjkxMTQyMzIzNTYzOTA5LCAzMC41MDAyNDU4NzA2NTg0MV0sXHJcbiAgICBbNTkuODg2OTMxNjE3ODQ2MDYsIDMwLjMxOTY1ODEwMjEwMzcxM10sXHJcbiAgICBbNTkuOTcwMzM1NzQ4MjE2NzIsIDMwLjMxNTE5NDkwNjMwMjkyNF0sXHJcbiAgXTtcclxuICBjb25zdCBteUNvbGxlY3Rpb24gPSBuZXcgeW1hcHMuR2VvT2JqZWN0Q29sbGVjdGlvbihcclxuICAgIHt9LFxyXG4gICAge1xyXG4gICAgICBkcmFnZ2FibGU6IGZhbHNlLFxyXG4gICAgICBpY29uTGF5b3V0OiBcImRlZmF1bHQjaW1hZ2VcIixcclxuICAgICAgaWNvbkltYWdlSHJlZjogXCIuL2ltZy9tYXJrZXIuc3ZnXCIsXHJcbiAgICAgIGljb25JbWFnZVNpemU6IFs0NiwgNTddLFxyXG4gICAgICBpY29uSW1hZ2VPZmZzZXQ6IFstMzUsIC01Ml0sXHJcbiAgICB9XHJcbiAgKTtcclxuICBjb29yZHMuZm9yRWFjaCgoY29vcmQpID0+IHtcclxuICAgIG15Q29sbGVjdGlvbi5hZGQobmV3IHltYXBzLlBsYWNlbWFyayhjb29yZCkpO1xyXG4gIH0pO1xyXG5cclxuICBteU1hcC5nZW9PYmplY3RzLmFkZChteUNvbGxlY3Rpb24pO1xyXG4gIG15TWFwLmJlaGF2aW9ycy5kaXNhYmxlKFwic2Nyb2xsWm9vbVwiKTtcclxufTtcclxuXHJcbnltYXBzLnJlYWR5KGluaXQpO1xyXG4iLCJjb25zdCB2YWxpZGF0ZUZpZWxkcyA9IChmb3JtLCBmaWVsZHNBcnJheSkgPT4ge1xyXG4gIGZpZWxkc0FycmF5LmZvckVhY2goKGZpZWxkKSA9PiB7XHJcbiAgICBmaWVsZC5yZW1vdmVDbGFzcyhcImlucHV0LWVycm9yXCIpO1xyXG4gICAgaWYgKGZpZWxkLnZhbCgpLnRyaW0oKSA9PT0gXCJcIikge1xyXG4gICAgICBmaWVsZC5hZGRDbGFzcyhcImlucHV0LWVycm9yXCIpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIGNvbnN0IGVycm9yRmllbGRzID0gZm9ybS5maW5kKFwiLmlucHV0LWVycm9yXCIpO1xyXG4gIHJldHVybiBlcnJvckZpZWxkcy5sZW5ndGggPT09IDA7XHJcbn07XHJcblxyXG4kKFwiLmZvcm1fX2J0blwiKS5vbignY2xpY2snLChlKSA9PiB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICBjb25zdCBmb3JtID0gJChcIi5mb3JtXCIpO1xyXG4gIGNvbnN0IG5hbWUgPSBmb3JtLmZpbmQoXCJbbmFtZSA9ICduYW1lJ11cIik7XHJcbiAgY29uc3QgcGhvbmUgPSBmb3JtLmZpbmQoXCJbbmFtZSA9ICdwaG9uZSddXCIpO1xyXG4gIGNvbnN0IGNvbW1lbnQgPSBmb3JtLmZpbmQoXCIuZm9ybV9faW5wdXQtLXRleHRhcmVhXCIpO1xyXG4gIGNvbnN0IHRvID0gZm9ybS5maW5kKFwiW25hbWUgPSAndG8nXVwiKTtcclxuICBjb25zdCBjb250ZW50ID0gJChcIi5tb2RhbF9fY29udGVudFwiKTtcclxuICBpc1ZhbGlkID0gdmFsaWRhdGVGaWVsZHMoZm9ybSwgW25hbWUsIHBob25lLCBjb21tZW50LCB0b10pO1xyXG5cclxuICBpZiAoaXNWYWxpZCkge1xyXG4gICAgY29uc3QgcmVxdWVzdCA9ICQuYWpheCh7XHJcbiAgICAgIHVybDogXCJodHRwczovL3dlYmRldi1hcGkubG9mdHNjaG9vbC5jb20vc2VuZG1haWxcIixcclxuICAgICAgbWV0aG9kOiBcInBvc3RcIixcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIG5hbWU6IG5hbWUudmFsKCksXHJcbiAgICAgICAgcGhvbmU6IHBob25lLnZhbCgpLFxyXG4gICAgICAgIGNvbW1lbnQ6IGNvbW1lbnQudmFsKCksXHJcbiAgICAgICAgdG86IHRvLnZhbCgpLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcbiAgICByZXF1ZXN0LmRvbmUoKGRhdGEpID0+IHtcclxuICAgICAgY29udGVudC5yZW1vdmVDbGFzcyhcImVycm9yLXRleHRcIik7XHJcbiAgICAgIGNvbnRlbnQudGV4dChkYXRhLm1lc3NhZ2UpO1xyXG4gICAgfSk7XHJcbiAgICByZXF1ZXN0LmZhaWwoKGRhdGEpID0+IHtcclxuICAgICAgbGV0IG1lc3NhZ2U7XHJcbiAgICAgIGlmKGRhdGE/LnJlc3BvbnNlSlNPTj8ubWVzc2FnZSl7XHJcbiAgICAgICAgbWVzc2FnZSA9IHJlc3BvbnNlSlNPTi5tZXNzYWdlXHJcbiAgICAgIH1lbHNle1xyXG4gICAgICAgIG1lc3NhZ2UgPSAn0J/RgNC+0LjQt9C+0YjQu9CwINC+0YjQuNCx0LrQsCzQv9C+0L/RgNC+0LHRg9C50YLQtSDQv9C+0LfQttC1J1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnRlbnQudGV4dChtZXNzYWdlKTtcclxuICAgICAgY29udGVudC5hZGRDbGFzcyhcImVycm9yLXRleHRcIik7XHJcbiAgICB9KTtcclxuICAgIHJlcXVlc3QuYWx3YXlzKCgpID0+IHtcclxuICAgICAkLmZhbmN5Ym94Lm9wZW4oe1xyXG4gICAgICBzcmM6JyNmb3JtLW1vZGFsJyxcclxuICAgICAgdHlwZTonaW5saW5lJyxcclxuICAgICB9KVxyXG4gICAgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbiQoXCIuYnRuLS1jbG9zZVwiKS5vbignY2xpY2snLChlKSA9PiB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICQuZmFuY3lib3guY2xvc2UoKVxyXG4gIC8vICQoXCIuZm9ybS1tb2RhbFwiKS5jc3MoeyBoZWlnaHQ6IFwiMCVcIiwgd2lkdGg6IFwiMCVcIiB9KTtcclxufSk7XHJcbiIsIlxyXG4vL21ldGhvZHNcclxuLy8gJC5mbi5mdWxscGFnZS5zZXRBbGxvd1Njcm9sbGluZyhmYWxzZSk7XHJcblxyXG5sZXQgZG9GdWxscGFnZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDtcclxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xyXG4gIC8v0YfRgtC+INCx0Ysg0L3QtSDRgNCw0LHQvtGC0LDQuyDQvdCwINC80L7QsdC40LvQutCw0YVcclxuICAvLyBpZiAoZG9GdWxscGFnZSA+IDc2OCkge1xyXG4gICAgJChcIiNmdWxscGFnZVwiKS5mdWxscGFnZSh7XHJcbiAgICAgIC8vb3B0aW9ucyBoZXJlXHJcbiAgICAgIHNjcm9sbE92ZXJmbG93OiBmYWxzZSxcclxuICAgICAgYXV0b1Njcm9sbGluZzogdHJ1ZSxcclxuICAgICAgc2Nyb2xsSG9yaXpvbnRhbGx5OiB0cnVlLFxyXG4gICAgICB2ZXJ0aWNhbENlbnRlcmVkOiBmYWxzZSxcclxuICAgICAgZml0VG9TZWN0aW9uOiBmYWxzZSxcclxuICAgICAgbmF2aWdhdGlvbjogdHJ1ZSxcclxuICAgICAgLy8gYW5jaG9yczpbJyN3aHknLCAnI2JvYXJkcycsICcjcmV2aWV3cyddLFxyXG4gICAgICBzY3JvbGxPdmVyZmxvdzogZmFsc2UsXHJcblxyXG4gICAgICAvLyBmaXhlZEVsZW1lbnRzOignLmhlYWRlcicpXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG4pO1xyXG4kKFwiW2RhdGEtc2Nyb2xsLXRvXVwiKS5vbignY2xpY2snLChlKSA9PiB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gIGNvbnN0IHRhcmdldCA9ICR0aGlzLmF0dHIoXCJkYXRhLXNjcm9sbC10b1wiKTtcclxuICBjb25zdCByZXFTZWN0aW9uID0gJChgW2RhdGEtc2VjdGlvbi1pZCA9ICR7dGFyZ2V0fV1gKTtcclxuXHJcbiAgcGVyZm9ybVRyYW5zaXRpb24ocmVxU2VjdGlvbi5pbmRleCgpKTtcclxufSk7XHJcblxyXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0vL1xyXG5cclxuY29uc3Qgc2VjdGlvbnMgPSAkKFwic2VjdGlvblwiKTtcclxuY29uc3QgZGlzcGxheSA9ICQoXCIubWFpbmNvbnRlbnRcIik7XHJcbmxldCBpblNjcm9sbCA9IGZhbHNlO1xyXG5zZWN0aW9ucy5maXJzdCgpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xyXG5cclxuY29uc3QgcGVyZm9ybVRyYW5zaXRpb24gPSAoc2VjdGlvbkVxKSA9PiB7XHJcbiAgaWYgKGluU2Nyb2xsID09PSBmYWxzZSkge1xyXG4gICAgaW5TY3JvbGwgPSB0cnVlO1xyXG4gICAgY29uc3QgcG9zaXRpb24gPSBzZWN0aW9uRXEgKiAtMTAwO1xyXG4gICAgZGlzcGxheS5jc3Moe1xyXG4gICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGVZKCR7cG9zaXRpb259JSlgLFxyXG4gICAgfSk7XHJcbiAgICBzZWN0aW9ucy5lcShzZWN0aW9uRXEpLmFkZENsYXNzKFwiYWN0aXZlXCIpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgaW5TY3JvbGwgPSBmYWxzZTtcclxuICAgIH0sIDgwMCk7XHJcbiAgfVxyXG59O1xyXG4vLyBjb25zdCB2aWV3cG9ydFNjcm9sbGVyID0gKCkgPT4ge1xyXG4vLyAgIGNvbnN0IGFjdGl2ZVNlY3Rpb24gPSBzZWN0aW9ucy5maWx0ZXIoXCIuYWN0aXZlXCIpO1xyXG4vLyAgIGNvbnN0IG5leHRTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5uZXh0KCk7XHJcbi8vICAgY29uc3QgcHJldlNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLnByZXYoKTtcclxuLy8gICByZXR1cm4ge1xyXG4vLyAgICAgbmV4dCgpIHtcclxuLy8gICAgICAgaWYgKG5leHRTZWN0aW9uLmxlbmd0aCkge1xyXG4vLyAgICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKG5leHRTZWN0aW9uLmluZGV4KCkpO1xyXG4vLyAgICAgICB9XHJcbi8vICAgICB9LFxyXG4vLyAgICAgcHJldigpIHtcclxuLy8gICAgICAgaWYgKHByZXZTZWN0aW9uLmxlbmd0aCkge1xyXG4vLyAgICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKHByZXZTZWN0aW9uLmluZGV4KCkpO1xyXG4vLyAgICAgICB9XHJcbi8vICAgICB9LFxyXG4vLyAgIH07XHJcbi8vIH07XHJcbi8vICQod2luZG93KS5vbihcIndoZWVsXCIsIChlKSA9PiB7XHJcbi8vICAgY29uc3QgZGVsdGFZID0gZS5vcmlnaW5hbEV2ZW50LmRlbHRhWTtcclxuLy8gICBjb25zdCBzY3JvbGxlciA9IHZpZXdwb3J0U2Nyb2xsZXIoKTtcclxuLy8gICAvLyBsZXQgbWFwID0gJCgnLm1hcCcpXHJcbi8vICAgLy8gY29uc29sZS5sb2cobWFwKVxyXG4vLyAgIGlmIChkZWx0YVkgPiAwKSB7XHJcbi8vICAgICAvLyYmIGUudGFyZ2V0ICE9IG1hcFxyXG4vLyAgICAgLy9uZXh0XHJcbi8vICAgICBzY3JvbGxlci5uZXh0KCk7XHJcbi8vICAgfVxyXG4vLyAgIGlmIChkZWx0YVkgPCAwKSB7XHJcbi8vICAgICAvL3ByZXZcclxuLy8gICAgIHNjcm9sbGVyLnByZXYoKTtcclxuLy8gICB9XHJcbi8vIH0pO1xyXG4vLyAkKHdpbmRvdykub24oXCJrZXlkb3duXCIsIChlKSA9PiB7XHJcbi8vICAgY29uc3QgdGFnTmFtZSA9IGUudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcclxuLy8gICBjb25zdCBzY3JvbGxlciA9IHZpZXdwb3J0U2Nyb2xsZXIoKTtcclxuLy8gICBpZiAodGFnTmFtZSAhPSBcInRleHRhcmVhXCIgJiYgdGFnTmFtZSAhPSBcImlucHV0XCIpIHtcclxuLy8gICAgIHN3aXRjaCAoZS5rZXkpIHtcclxuLy8gICAgICAgY2FzZSAzODpcclxuLy8gICAgICAgICBzY3JvbGxlci5wcmV2KCk7XHJcbi8vICAgICAgICAgYnJlYWs7XHJcbi8vICAgICAgIGNhc2UgNDA6XHJcbi8vICAgICAgICAgc2Nyb2xsZXIubmV4dCgpO1xyXG4vLyAgICAgICAgIGJyZWFrO1xyXG4vLyAgICAgfVxyXG4vLyAgIH1cclxuLy8gfSk7XHJcblxyXG4vLyAkKFwiW2RhdGEtc2Nyb2xsLXRvXVwiKS5vbignY2xpY2snLChlKSA9PiB7XHJcbi8vICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4vLyAgIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4vLyAgIGNvbnN0IHRhcmdldCA9ICR0aGlzLmF0dHIoXCJkYXRhLXNjcm9sbC10b1wiKTtcclxuLy8gICBjb25zdCByZXFTZWN0aW9uID0gJChgW2RhdGEtc2VjdGlvbi1pZCA9ICR7dGFyZ2V0fV1gKTtcclxuXHJcbi8vICAgcGVyZm9ybVRyYW5zaXRpb24ocmVxU2VjdGlvbi5pbmRleCgpKTtcclxuLy8gfSk7XHJcblxyXG4vLyAvL2h0dHBzOi8vZ2l0aHViLmNvbS9tYXR0YnJ5c29uL1RvdWNoU3dpcGUtSnF1ZXJ5LVBsdWdpblxyXG4vLyAkKGZ1bmN0aW9uICgpIHtcclxuLy8gICAkKFwiYm9keVwiKS5zd2lwZSh7XHJcblxyXG4vLyAgICAgLy9HZW5lcmljIHN3aXBlIGhhbmRsZXIgZm9yIGFsbCBkaXJlY3Rpb25zXHJcbi8vICAgICBzd2lwZTogZnVuY3Rpb24gKGV2ZW50LCBkaXJlY3Rpb24pIHtcclxuLy8gICAgICAgY29uc3Qgc2Nyb2xsZXIgPSB2aWV3cG9ydFNjcm9sbGVyKCk7XHJcbi8vICAgICAgIGxldCBzY3JvbGxEaXJlY3Rpb24gPSBcIlwiO1xyXG4vLyAgICAgICBpZiAoZGlyZWN0aW9uID09PSBcInVwXCIpIHtcclxuLy8gICAgICAgICBzY3JvbGxEaXJlY3Rpb24gPSBcIm5leHRcIjtcclxuLy8gICAgICAgfVxyXG4vLyAgICAgICBpZiAoZGlyZWN0aW9uID09PSBcImRvd25cIikge1xyXG4vLyAgICAgICAgIHNjcm9sbERpcmVjdGlvbiA9IFwicHJldlwiO1xyXG4vLyAgICAgICB9XHJcbi8vICAgICAgIHNjcm9sbGVyW3Njcm9sbERpcmVjdGlvbl0oKTtcclxuLy8gICAgIH0sXHJcbi8vICAgfSk7XHJcbi8vIH0pO1xyXG4iLCIvLyBsZXQgcGxheWVyO1xyXG4vLyBjb25zdCBwbGF5ZXJDb250YWluZXIgPSAkKFwiLnBsYXllclwiKTtcclxuLy8gY29uc3QgcGxheWVyU3RhcnQgPSAkKFwiLnBsYXllcl9fc3RhcnRcIik7XHJcbi8vIGNvbnN0IHBsYXllclNwbGFzaCA9ICQoXCIucGxheWVyX19zcGxhc2hcIik7XHJcbi8vIC8vLy9wbGF5L3BhdXNlLy8vL1xyXG5cclxuLy8gLy8vL3NlY29uZHMgdG8gc2Vjb25kczptaW51dGVzLy8vL1xyXG4vLyBjb25zdCBmb3JtYXRUaW1lID0gKHRpbWVTZWMpID0+IHtcclxuLy8gICBjb25zdCByb3VuZFRpbWUgPSBNYXRoLnJvdW5kKHRpbWVTZWMpO1xyXG5cclxuLy8gICBjb25zdCBtaW51dGVzID0gYWRkWmVybyhNYXRoLmZsb29yKHJvdW5kVGltZSAvIDYwKSk7XHJcbi8vICAgY29uc3Qgc2Vjb25kcyA9IGFkZFplcm8ocm91bmRUaW1lIC0gbWludXRlcyAqIDYwKTtcclxuXHJcbi8vICAgZnVuY3Rpb24gYWRkWmVybyhudW0pIHtcclxuLy8gICAgIHJldHVybiBudW0gPCAxMCA/IGAwJHtudW19YCA6IG51bTtcclxuLy8gICB9XHJcblxyXG4vLyAgIHJldHVybiBgJHttaW51dGVzfSA6ICR7c2Vjb25kc31gO1xyXG4vLyB9O1xyXG4vLyAvLy8vXnNlY29uZHMgdG8gc2Vjb25kczptaW51dGVzLy8vL1xyXG5cclxuLy8gLy8vL2R1cmF0aW9uLy8vL1xyXG4vLyBjb25zdCBvblBsYXllclJlYWR5ID0gKCkgPT4ge1xyXG4vLyAgIGNvbnN0IGR1cmF0aW9uU2VjID0gcGxheWVyLmdldER1cmF0aW9uKCk7XHJcblxyXG4vLyAgICQoXCIucGxheWVyX19kdXJhdGlvbi1lc3RpbWF0ZVwiKS50ZXh0KGZvcm1hdFRpbWUoZHVyYXRpb25TZWMpKTtcclxuLy8gICBpZiAodHlwZW9mIGludGVydmFsICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbi8vICAgICBjbGVhckludGVydmFsKGludGVydmFsKTtcclxuLy8gICB9XHJcbi8vICAgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbi8vICAgICBjb25zdCBjb21wbGV0ZWRTZWMgPSBwbGF5ZXIuZ2V0Q3VycmVudFRpbWUoKTtcclxuLy8gICAgIGNvbnN0IGNvbXBsZXRlZFBlcmNlbnQgPSAoY29tcGxldGVkU2VjIC8gZHVyYXRpb25TZWMpICogMTAwO1xyXG4vLyAgICAgJChcIi5wbGF5ZXJfX3BsYXliYWNrLWJ1dHRvblwiKS5jc3Moe1xyXG4vLyAgICAgICBsZWZ0OiBgJHtjb21wbGV0ZWRQZXJjZW50fSVgLFxyXG4vLyAgICAgfSk7XHJcbi8vICAgICAkKFwiLnBsYXllcl9fZHVyYXRpb24tY29tcGxldGVkXCIpLnRleHQoZm9ybWF0VGltZShjb21wbGV0ZWRTZWMpKTtcclxuLy8gICB9LCAxMDAwKTtcclxuLy8gfTtcclxuLy8gLy8vL15kdXJhdGlvbi8vLy9cclxuXHJcbi8vIC8vLy9wbGF5YmFja0J1dHRvbk1vdmUvLy8vXHJcbi8vICQoXCIucGxheWVyX19wbGF5YmFja1wiKS5jbGljaygoZSkgPT4ge1xyXG4vLyAgIGNvbnN0IGJhciA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuLy8gICBjb25zdCBjbGlja2VkUG9zaXRpb24gPSBlLm9yaWdpbmFsRXZlbnQubGF5ZXJYO1xyXG4vLyAgIGNvbnN0IG5ld0J1dHRvblBvc2l0aW9uUGVyY2VudCA9IChjbGlja2VkUG9zaXRpb24gLyBiYXIud2lkdGgoKSkgKiAxMDA7XHJcbi8vICAgY29uc3QgbmV3UGxheWJhY2tQb3NpdGlvblNlYyA9XHJcbi8vICAgICAocGxheWVyLmdldER1cmF0aW9uKCkgLyAxMDApICogbmV3QnV0dG9uUG9zaXRpb25QZXJjZW50O1xyXG5cclxuLy8gICAkKFwiLnBsYXllcl9fcGxheWJhY2stYnV0dG9uXCIpLmNzcyh7XHJcbi8vICAgICBsZWZ0OiBgJHtuZXdCdXR0b25Qb3NpdGlvblBlcmNlbnR9JWAsXHJcbi8vICAgfSk7XHJcblxyXG4vLyAgIHBsYXllci5zZWVrVG8obmV3UGxheWJhY2tQb3NpdGlvblNlYyk7XHJcbi8vIH0pO1xyXG4vLyAvLy8vXnBsYXliYWNrQnV0dG9uTW92ZS8vLy9cclxuXHJcbi8vIGZ1bmN0aW9uIG9uWW91VHViZUlmcmFtZUFQSVJlYWR5KCkge1xyXG4vLyAgIHBsYXllciA9IG5ldyBZVC5QbGF5ZXIoXCJ5dC1wbGF5ZXJcIiwge1xyXG4vLyAgICAgaGVpZ2h0OiBcIjQwNVwiLFxyXG4vLyAgICAgd2lkdGg6IFwiNjYwXCIsXHJcbi8vICAgICB2aWRlb0lkOiBcIlR4WndxVlRhQ21BXCIsXHJcbi8vICAgICBldmVudHM6IHtcclxuLy8gICAgICAgb25SZWFkeTogb25QbGF5ZXJSZWFkeSxcclxuLy8gICAgICAgLy8gb25TdGF0ZUNoYW5nZTogb25QbGF5ZXJTdGF0ZUNoYW5nZVxyXG4vLyAgICAgfSxcclxuLy8gICAgIHBsYXllclZhcnM6IHtcclxuLy8gICAgICAgY29udHJvbHM6IDAsXHJcbi8vICAgICAgIGRpc2FibGVrYjogMCxcclxuLy8gICAgICAgc2hvaW5mbzogMCxcclxuLy8gICAgICAgcmVsOiAwLFxyXG4vLyAgICAgICBhdXRvcGxheTogMCxcclxuLy8gICAgICAgbW9kZXN0YnJhbmRpbmc6IDAsXHJcbi8vICAgICB9LFxyXG4vLyAgIH0pO1xyXG4vLyB9XHJcbi8vIGxldCBldmVudHNJbml0ID0gKCkgPT4ge1xyXG4vLyAgICQoXCIucGxheWVyX19zdGFydFwiKS5jbGljaygoZSkgPT4ge1xyXG4vLyAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4vLyAgICAgaWYgKHBsYXllclN0YXJ0Lmhhc0NsYXNzKFwicGxheWVyX19zdGFydC0tcGF1c2VkXCIpKSB7XHJcbi8vICAgICAgIHBsYXllclN0YXJ0LiBvdmVDbGFzcyhcInBsYXllcl9fc3RhcnQtLXBhdXNlZFwiKTtcclxuLy8gICAgICAgcGxheWVyU3BsYXNoLiBvdmVDbGFzcyhcInBsYXllcl9fc3BsYXNoLS1hY3RpdmVcIik7XHJcbi8vICAgICAgIHBsYXllci5wYXVzZVZpZGVvKCk7XHJcbi8vICAgICB9IGVsc2Uge1xyXG4vLyAgICAgICBwbGF5ZXJTdGFydC5hZGRDbGFzcyhcInBsYXllcl9fc3RhcnQtLXBhdXNlZFwiKTtcclxuLy8gICAgICAgcGxheWVyU3BsYXNoLmFkZENsYXNzKFwicGxheWVyX19zcGxhc2gtLWFjdGl2ZVwiKTtcclxuLy8gICAgICAgcGxheWVyLnBsYXlWaWRlbygpO1xyXG4vLyAgICAgfVxyXG4vLyAgIH0pO1xyXG4vLyB9O1xyXG4vLyAvLy8vXnBsYXkvcGF1c2UvLy8vXHJcblxyXG4vLyBldmVudHNJbml0KCk7XHJcblxyXG4vL3ZpZGVvcGxheWVyXHJcbmNvbnN0IHBsYXllciA9ICQoXCIjdmlkZW8tcGxheWVyXCIpWzBdO1xyXG5jb25zdCBwbGF5ZXJDb250YWluZXIgPSAkKFwiLnBsYXllclwiKTtcclxuY29uc3QgcGxheWVyU3RhcnQgPSAkKFwiLnBsYXllcl9fc3RhcnRcIik7XHJcbmNvbnN0IHBsYXllclNwbGFzaCA9ICQoXCIucGxheWVyX19zcGxhc2hcIik7XHJcbmNvbnN0IHZvbHVtZUJ1dHRvbiA9ICQoJy5wbGF5ZXJfX3ZvbHVtZS1idXR0b24nKVxyXG5jb25zdCB2b2x1bWVQYXliYWNrID0gJCgnLnBsYXllcl9fdm9sdW1lJylcclxubGV0IGludGVydmFsO1xyXG5sZXQgdmlkZW9EdXJhdGlvbiA9IDA7XHJcblxyXG5wbGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZGVkZGF0YScsKCkgPT57XHJcbiAgdmlkZW9EdXJhdGlvbiA9IHBsYXllci5kdXJhdGlvblxyXG4gICQoXCIucGxheWVyX19kdXJhdGlvbi1lc3RpbWF0ZVwiKS50ZXh0KGZvcm1hdFRpbWUodmlkZW9EdXJhdGlvbikpO1xyXG59KVxyXG52b2x1bWVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLGNvbnNvbGUubG9nKHZvbHVtZUJ1dHRvbikpXHJcblxyXG4vLyBjb25zdCBzb3VuZE9mID0gKCk9PntcclxuLy8gICBjb25zb2xlLmxvZyh2b2x1bWVCdXR0b24pXHJcbi8vIH1cclxuY29uc3QgZm9ybWF0VGltZSA9ICh0aW1lU2VjKSA9PiB7XHJcbiAgY29uc3Qgcm91bmRUaW1lID0gTWF0aC5yb3VuZCh0aW1lU2VjKTtcclxuXHJcbiAgY29uc3QgbWludXRlcyA9IGFkZFplcm8oTWF0aC5mbG9vcihyb3VuZFRpbWUgLyA2MCkpO1xyXG4gIGNvbnN0IHNlY29uZHMgPSBhZGRaZXJvKHJvdW5kVGltZSAtIG1pbnV0ZXMgKiA2MCk7XHJcblxyXG4gIGZ1bmN0aW9uIGFkZFplcm8obnVtKSB7XHJcbiAgICByZXR1cm4gbnVtIDwgMTAgPyBgMCR7bnVtfWAgOiBudW07XHJcbiAgfVxyXG5cclxuICByZXR1cm4gYCR7bWludXRlc30gOiAke3NlY29uZHN9YDtcclxufTtcclxuXHJcbmNvbnN0IG9uUGxheWVyUmVhZHkgPSAoKSA9PiB7XHJcblxyXG5cclxuXHJcbiAgaWYgKHR5cGVvZiBpbnRlcnZhbCAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XHJcbiAgfVxyXG4gIGludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgY29uc3QgY29tcGxldGVkU2VjID0gcGxheWVyLmN1cnJlbnRUaW1lO1xyXG4gICAgY29uc3QgY29tcGxldGVkUGVyY2VudCA9IChjb21wbGV0ZWRTZWMgLyB2aWRlb0R1cmF0aW9uKSAqIDEwMDtcclxuICAgICQoXCIucGxheWVyX19wbGF5YmFjay1idXR0b25cIikuY3NzKHtcclxuICAgICAgbGVmdDogYCR7Y29tcGxldGVkUGVyY2VudH0lYCxcclxuICAgIH0pO1xyXG4gICAgJChcIi5wbGF5ZXJfX2R1cmF0aW9uLWNvbXBsZXRlZFwiKS50ZXh0KGZvcm1hdFRpbWUoY29tcGxldGVkU2VjKSk7XHJcbiAgfSwgMTAwMCk7XHJcbn07XHJcblxyXG4kKFwiLnBsYXllcl9fcGxheWJhY2tcIikub24oJ2NsaWNrJywoZSkgPT4ge1xyXG4gIGNvbnN0IGJhciA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCBjbGlja2VkUG9zaXRpb24gPSBlLm9yaWdpbmFsRXZlbnQubGF5ZXJYO1xyXG4gIGNvbnN0IG5ld0J1dHRvblBvc2l0aW9uUGVyY2VudCA9IChjbGlja2VkUG9zaXRpb24gLyBiYXIud2lkdGgoKSkgKiAxMDA7XHJcbiAgY29uc3QgbmV3UGxheWJhY2tQb3NpdGlvblNlYyA9XHJcbiAgICAocGxheWVyLmR1cmF0aW9uIC8gMTAwKSAqIG5ld0J1dHRvblBvc2l0aW9uUGVyY2VudDtcclxuXHJcblxyXG4gICQoXCIucGxheWVyX19wbGF5YmFjay1idXR0b25cIikuY3NzKHtcclxuICAgIGxlZnQ6IGAke25ld0J1dHRvblBvc2l0aW9uUGVyY2VudH0lYCxcclxuICB9KTtcclxuXHJcbiAgcGxheWVyLmN1cnJlbnRUaW1lID0gbmV3UGxheWJhY2tQb3NpdGlvblNlYztcclxufSk7XHJcblxyXG5sZXQgZXZlbnRzSW5pdCA9ICgpID0+IHtcclxuICAkKFwiLnBsYXllcl9fc3RhcnRcIikub24oJ2NsaWNrJywoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgaWYgKHBsYXllclN0YXJ0Lmhhc0NsYXNzKFwicGxheWVyX19zdGFydC0tcGF1c2VkXCIpKSB7XHJcbiAgICAgIHBsYXllclN0YXJ0LnJlbW92ZUNsYXNzKFwicGxheWVyX19zdGFydC0tcGF1c2VkXCIpO1xyXG4gICAgICBwbGF5ZXJTcGxhc2gucmVtb3ZlQ2xhc3MoXCJwbGF5ZXJfX3NwbGFzaC0tYWN0aXZlXCIpO1xyXG4gICAgICBwbGF5ZXIucGF1c2UoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHBsYXllclN0YXJ0LmFkZENsYXNzKFwicGxheWVyX19zdGFydC0tcGF1c2VkXCIpO1xyXG4gICAgICBwbGF5ZXJTcGxhc2guYWRkQ2xhc3MoXCJwbGF5ZXJfX3NwbGFzaC0tYWN0aXZlXCIpO1xyXG4gICAgICBwbGF5ZXIucGxheSgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG5cclxuZXZlbnRzSW5pdCgpO1xyXG5vblBsYXllclJlYWR5KCk7XHJcbi8vIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCByZWFkeSk7XHJcbiIsImNvbnN0IGZpbmRCbG9ja0J5QWxpYXMgPSBhbGlhcyA9PntcclxuICByZXR1cm4gJCgnLnJldmlld3NfX2l0ZW0nKS5maWx0ZXIoKG5keCxpdGVtKT0+e1xyXG4gICAgcmV0dXJuICQoaXRlbSkuYXR0cignZGF0YS1saW5rZWQtd2l0aCcpID09PSBhbGlhc1xyXG4gIH0pXHJcbn1cclxuJCgnLnJldmlld3NfX2xpbmsnKS5vbignY2xpY2snLGU9PntcclxuICBlLnByZXZlbnREZWZhdWx0KClcclxuXHJcbiAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldClcclxuICBjb25zdCB0YXJnZXQgPSAkdGhpcy5hdHRyKCdkYXRhLW9wZW4nKVxyXG4gIGNvbnN0IGl0ZW1Ub1Nob3cgPSBmaW5kQmxvY2tCeUFsaWFzKHRhcmdldClcclxuICBjb25zdCBjdXJJdGVtID0gJHRoaXMuY2xvc2VzdCgnLnJldmlld3NfX2xpbmsnKVxyXG4gIGl0ZW1Ub1Nob3cuYWRkQ2xhc3MoJ3Jldmlld3NfX2l0ZW0tLWFjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ3Jldmlld3NfX2l0ZW0tLWFjdGl2ZScpXHJcbiAgY3VySXRlbS5hZGRDbGFzcygncmV2aWV3c19fbGluay0tYWN0aXZlJykuc2libGluZ3MoKS5yZW1vdmVDbGFzcygncmV2aWV3c19fbGluay0tYWN0aXZlJylcclxufSkiLCJsZXQgbWVzdXJlID0gKGNvbnRlbnQsIGl0ZW0pID0+IHtcclxuICBsZXQgdGl0bGVCb3ggPSBpdGVtLmZpbmQoXCIuaG9yaXpvbnRhbC1zbGlkZXJfX3RpdGxlLWJveFwiKTtcclxuICBsZXQgaXRlbXNXaWR0aCA9IHRpdGxlQm94LndpZHRoKCkgKiAzO1xyXG4gIGNvbnN0IGlzVGFibGV0ID1cclxuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCA8PSA3NjggJiZcclxuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCA+IDQ4MDtcclxuICBjb25zdCBpc01vYmlsZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCA8PSA0ODE7XHJcbiAgaWYgKGlzVGFibGV0KSB7XHJcbiAgICByZXR1cm4gY29udGVudC5hbmltYXRlKHtcclxuICAgICAgd2lkdGg6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCAtIGl0ZW1zV2lkdGgsXHJcbiAgICB9KTtcclxuICB9XHJcbiAgaWYgKGlzTW9iaWxlKSB7XHJcbiAgICByZXR1cm4gY29udGVudC5hbmltYXRlKHtcclxuICAgICAgd2lkdGg6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCAtIHRpdGxlQm94LndpZHRoKCksXHJcbiAgICB9KTtcclxuICB9XHJcbiAgcmV0dXJuIGNvbnRlbnQuYW5pbWF0ZSh7XHJcbiAgICB3aWR0aDogXCI1MjBweFwiLFxyXG4gIH0pO1xyXG59O1xyXG4kKGZ1bmN0aW9uICgpIHtcclxuICAvL9C+0LHRgNCw0LHQsNGC0YvQstCw0LXQvCDQutC70LjQuiDQv9C+INCx0LvQvtC60YMg0YEg0LrQu9Cw0YHRgdC+0LwgaG9yaXpvbnRhbC1zbGlkZXJfX3RpdGxlXHJcbiAgJChcIi5ob3Jpem9udGFsLXNsaWRlcl9fdGl0bGUtYm94XCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIC8v0L/QvtC70YPRh9Cw0LXQvCDQvdGD0LbQvdGL0LUg0L3QsNC8INC00LDQvdC90YvQtVxyXG4gICAgbGV0ICR0aGlzID0gJCh0aGlzKSxcclxuICAgICAgLy/Qv9C+0LvRg9GH0LDQtdC8INCy0YHRkSDQsdC70L7QutC4IGxpc3RcclxuICAgICAgY29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi5ob3Jpem9udGFsLXNsaWRlcl9fbGlzdFwiKSxcclxuICAgICAgLy/Qv9C+0LvRg9GH0LDQtdC8IGxpINC/0L4g0LrQvtGC0L7RgNC+0LzRgyDQutC70LjQutC90YPQu9C4XHJcbiAgICAgIGl0ZW0gPSAkdGhpcy5jbG9zZXN0KFwiLmhvcml6b250YWwtc2xpZGVyX19pdGVtXCIpLFxyXG4gICAgICAvL9C/0L7Qu9GD0YfQsNC10Lwg0LLRgdC1INC00YDRg9Cz0LjQtSBsaVxyXG4gICAgICBpdGVtcyA9IGNvbnRhaW5lci5maW5kKFwiLmhvcml6b250YWwtc2xpZGVyX19pdGVtXCIpLFxyXG4gICAgICAvL9Cy0YvQsdC40YDQsNC10Lwg0LjQtyBsaSDQsNC60YLQuNCy0L3Ri9C5XHJcbiAgICAgIGFjdGl2ZUl0ZW0gPSBpdGVtcy5maWx0ZXIoXCIuYWN0aXZlXCIpLFxyXG4gICAgICAvL9Cy0YvQsdC40YDQsNC10Lwg0LjQtyBsaSDQv9C+INC60L7RgtC+0YDQvtC80YMg0LrQu9C40LrQvdGD0LvQuCDQsdC70L7QuiDQutC+0L3RgtC10L1cclxuICAgICAgY29udGVudCA9IGl0ZW0uZmluZChcIi5ob3Jpem9udGFsLXNsaWRlcl9fY29udGVudC1ib3hcIiksXHJcbiAgICAgIC8v0LLRi9Cx0LjRgNCw0LXQvCDRgyBsaSDRgSDQutC70LDRgdGB0L7QvCBhY3RpdmUg0LHQu9C+0Log0LrQvtC90YLQtdC90YJcclxuICAgICAgYWN0aXZlQ29udGVudCA9IGFjdGl2ZUl0ZW0uZmluZChcIi5ob3Jpem9udGFsLXNsaWRlcl9fY29udGVudC1ib3hcIik7XHJcblxyXG4gICAgLy/QtdGB0LvQuCDQvdC10YIgbGkg0YEg0LrQu9Cw0YHRgdC+0LwgYWN0aXZlINC/0L4g0LrQvtGC0L7RgNC+0LzRgyDQutC70LjQutC90YPQu9C4XHJcbiAgICBpZiAoIWl0ZW0uaGFzQ2xhc3MoXCJhY3RpdmVcIikpIHtcclxuICAgICAgLy/Rg9Cx0LjRgNCw0LXQvCDQutC70LDRgdGBIGFjdGl2ZVxyXG4gICAgICBpdGVtcy5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcclxuICAgICAgLy/QtNC+0LHQsNCy0LvRj9C10LwgYWN0aXZlINC60LvQuNC60L3Rg9GC0L7QvNGDXHJcbiAgICAgIGl0ZW0uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICAgIC8v0YMg0YLQvtCz0L4g0YMg0LrQvtCz0L4g0LHRi9C7IGFjdGl2ZSDQt9Cw0LTQsNGR0Lwg0YjQuNGA0LjQvdGDIDBcclxuICAgICAgYWN0aXZlQ29udGVudC5hbmltYXRlKHtcclxuICAgICAgICB3aWR0aDogXCIwcHhcIixcclxuICAgICAgfSk7XHJcbiAgICAgIC8v0LrQu9C40LrQvdGD0YLQvtC80YMgNTMwXHJcbiAgICAgIG1lc3VyZShjb250ZW50LCBpdGVtKTtcclxuICAgICAgLy/QuNC90LDRh9C1XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpdGVtLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgICBjb250ZW50LmFuaW1hdGUoe1xyXG4gICAgICAgIHdpZHRoOiBcIjBweFwiLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgLy8g0LrQu9C40Log0LLQvdC1INCw0LrQutC+0YDQtNC10L7QvdCwXHJcbiAgJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgbGV0ICR0aGlzID0gJChlLnRhcmdldCk7XHJcbiAgICBpZiAoISR0aGlzLmNsb3Nlc3QoXCIuaG9yaXpvbnRhbC1zbGlkZXJfX2xpc3RcIikubGVuZ3RoKSB7XHJcbiAgICAgICQoXCIuaG9yaXpvbnRhbC1zbGlkZXJfX2NvbnRlbnQtYm94XCIpLmFuaW1hdGUoe1xyXG4gICAgICAgIHdpZHRoOiBcIiBcIixcclxuICAgICAgfSk7XHJcbiAgICAgICQoXCIuaG9yaXpvbnRhbC1zbGlkZXJfX2l0ZW1cIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn0pO1xyXG4iLCJjb25zdCBzbGlkZXIgPSAkKFwiLmJvYXJkc19fbGlzdFwiKS5ieFNsaWRlcih7XHJcbiAgcGFnZXI6IGZhbHNlLFxyXG4gIGNvbnRyb2xzOiBmYWxzZSxcclxufSk7XHJcblxyXG4kKFwiLmJvYXJkc19fbmF2LS1uZXh0XCIpLm9uKCdjbGljaycsKGUpID0+IHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgc2xpZGVyLmdvVG9OZXh0U2xpZGUoKTtcclxufSk7XHJcbiQoXCIuYm9hcmRzX19uYXYtLXByZXZcIikub24oJ2NsaWNrJywoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuICBzbGlkZXIuZ29Ub1ByZXZTbGlkZSgpO1xyXG59KTtcclxuIl19
